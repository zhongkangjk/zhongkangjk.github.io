<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>懒派日志</title>
  
  
  <link href="https://zhongkangjk.github.io/atom.xml" rel="self"/>
  
  <link href="https://zhongkangjk.github.io/"/>
  <updated>2022-04-23T11:24:50.665Z</updated>
  <id>https://zhongkangjk.github.io/</id>
  
  <author>
    <name>懒派大弟子</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>django-admin返回一个excel文件的按钮函数记录</title>
    <link href="https://zhongkangjk.github.io/2022/04/23/django-admin%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AAexcel%E6%96%87%E4%BB%B6%E7%9A%84%E6%8C%89%E9%92%AE%E5%87%BD%E6%95%B0%E8%AE%B0%E5%BD%95/"/>
    <id>https://zhongkangjk.github.io/2022/04/23/django-admin%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AAexcel%E6%96%87%E4%BB%B6%E7%9A%84%E6%8C%89%E9%92%AE%E5%87%BD%E6%95%B0%E8%AE%B0%E5%BD%95/</id>
    <published>2022-04-23T11:19:30.000Z</published>
    <updated>2022-04-23T11:24:50.665Z</updated>
    
    <content type="html"><![CDATA[<p>需要返回一个excel文件</p><span id="more"></span><h3 id="函数本体"><a href="#函数本体" class="headerlink" title="函数本体"></a>函数本体</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> 统计到<span class="title">excel</span>(<span class="params">self, request, queryset</span>):</span></span><br><span class="line">        <span class="comment">### 统计数量和</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> 返回姓名的合计(<span class="params">姓名</span>):</span></span><br><span class="line">            字典 = queryset.<span class="built_in">filter</span>(姓名=姓名).aggregate(Sum(<span class="string">&#x27;******&#x27;</span>),Sum(<span class="string">&#x27;****&#x27;</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">list</span>(字典.values())</span><br><span class="line">        姓名集合 = <span class="built_in">set</span>(queryset.<span class="built_in">all</span>().values_list(<span class="string">&#x27;姓名&#x27;</span>,flat=<span class="literal">True</span>)) <span class="comment">#主题去重</span></span><br><span class="line">        数据列表 = [[姓名,*返回姓名的合计(姓名)] <span class="keyword">for</span> 姓名 <span class="keyword">in</span> 姓名集合] <span class="comment">#制造数据列表</span></span><br><span class="line"></span><br><span class="line">        rd_book = xlrd.open_workbook(<span class="string">&#x27;******&#x27;</span>,formatting_info=<span class="literal">True</span>)</span><br><span class="line">        wb = copy(rd_book)  <span class="comment">#复制一下表</span></span><br><span class="line">        wb_sheet = wb.get_sheet(<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 设置单元格格式边框</span></span><br><span class="line">        borders = xlwt.Borders()</span><br><span class="line">        borders.left = <span class="number">1</span></span><br><span class="line">        borders.right = <span class="number">1</span></span><br><span class="line">        borders.top = <span class="number">1</span></span><br><span class="line">        borders.bottom = <span class="number">1</span></span><br><span class="line">        style = xlwt.XFStyle()</span><br><span class="line">        style.borders = borders</span><br><span class="line">        <span class="comment"># 设置单元格背景色为黄色</span></span><br><span class="line">        style1 = xlwt.XFStyle()</span><br><span class="line">        pattern = xlwt.Pattern()</span><br><span class="line">        pattern.pattern = xlwt.Pattern.SOLID_PATTERN</span><br><span class="line">        pattern.pattern_fore_colour = <span class="number">5</span>  <span class="comment">#5是黄色</span></span><br><span class="line">        style1.pattern = pattern</span><br><span class="line">        style1.borders = borders</span><br><span class="line">        <span class="comment"># 设置单元格字体</span></span><br><span class="line">        font = xlwt.Font()</span><br><span class="line">        font.name = <span class="string">&#x27;微软雅黑&#x27;</span></span><br><span class="line">        font.bold = <span class="literal">True</span></span><br><span class="line">        style.font = font</span><br><span class="line"></span><br><span class="line">        <span class="comment">## 一行一行往上套公式啊</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(数据列表)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(数据列表[i])):</span><br><span class="line">                wb_sheet.write(i+<span class="number">3</span>,j,数据列表[i][j],style)</span><br><span class="line">            当前行 = <span class="built_in">str</span>(i+<span class="number">4</span>)</span><br><span class="line">            wb_sheet.write(i+<span class="number">3</span>,<span class="built_in">len</span>(数据列表[i]),xlwt.Formula(<span class="string">&#x27;B3*B&#x27;</span>+当前行+<span class="string">&#x27;+C3*C&#x27;</span>+当前行+<span class="string">&#x27;+D3*D&#x27;</span>+当前行+<span class="string">&#x27;+E3*E&#x27;</span>+当前行+<span class="string">&#x27;+F3*F&#x27;</span>+当前行+<span class="string">&#x27;+G3*G&#x27;</span>+当前行+<span class="string">&#x27;+H3*H&#x27;</span>+当前行+<span class="string">&#x27;+I3*I&#x27;</span>+当前行+<span class="string">&#x27;+J3*J&#x27;</span>+当前行+<span class="string">&#x27;+K3*K&#x27;</span>+当前行+<span class="string">&#x27;+L3*L&#x27;</span>+当前行+<span class="string">&#x27;+M3*M&#x27;</span>+当前行+<span class="string">&#x27;+N3*N&#x27;</span>+当前行+<span class="string">&#x27;+O3*O&#x27;</span>+当前行+<span class="string">&#x27;+P3*P&#x27;</span>+当前行),style1)</span><br><span class="line"></span><br><span class="line">        wb_sheet.write(<span class="built_in">len</span>(数据列表)+<span class="number">3</span>,<span class="number">0</span>,<span class="string">&#x27;数量合计&#x27;</span>,style)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(数据列表[<span class="number">0</span>])-<span class="number">1</span>):</span><br><span class="line">            wb_sheet.write(<span class="built_in">len</span>(数据列表)+<span class="number">3</span>,i+<span class="number">1</span>,xlwt.Formula(<span class="string">&#x27;SUM(&#x27;</span>+<span class="built_in">chr</span>(<span class="number">66</span>+i)+<span class="string">&#x27;4:&#x27;</span>+<span class="built_in">chr</span>(<span class="number">66</span>+i)+<span class="built_in">str</span>(<span class="built_in">len</span>(数据列表)+<span class="number">3</span>)+<span class="string">&#x27;)&#x27;</span>),style1)</span><br><span class="line"></span><br><span class="line">        wb_sheet.write(<span class="built_in">len</span>(数据列表)+<span class="number">4</span>,<span class="number">0</span>,<span class="string">&#x27;金额合计&#x27;</span>,style1)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(数据列表[<span class="number">0</span>])-<span class="number">1</span>):</span><br><span class="line">            wb_sheet.write(<span class="built_in">len</span>(数据列表)+<span class="number">4</span>,i+<span class="number">1</span>,xlwt.Formula(<span class="built_in">chr</span>(<span class="number">66</span>+i)+<span class="string">&#x27;3*&#x27;</span>+<span class="built_in">chr</span>(<span class="number">66</span>+i)+<span class="built_in">str</span>(<span class="built_in">len</span>(数据列表)+<span class="number">4</span>)),style1)</span><br><span class="line">        wb_sheet.write(<span class="built_in">len</span>(数据列表)+<span class="number">3</span>,<span class="built_in">len</span>(数据列表[<span class="number">0</span>]),<span class="string">&#x27;&#x27;</span>,style1)</span><br><span class="line">        wb_sheet.write(<span class="built_in">len</span>(数据列表)+<span class="number">4</span>,<span class="built_in">len</span>(数据列表[<span class="number">0</span>]),xlwt.Formula(<span class="string">&#x27;SUM(B&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(数据列表)+<span class="number">4</span>+<span class="number">1</span>)+<span class="string">&#x27;:P&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(数据列表)+<span class="number">4</span>+<span class="number">1</span>)+<span class="string">&#x27;)&#x27;</span>),style1)</span><br><span class="line">        filename = <span class="string">&#x27;提成汇总表&#x27;</span>  <span class="comment">#中文不行 我也不知道为什么</span></span><br><span class="line">        response = HttpResponse(content_type=<span class="string">&#x27;application/vnd.ms-excel&#x27;</span>)</span><br><span class="line">        response[<span class="string">&#x27;Content-Disposition&#x27;</span>] = <span class="string">&#x27;attachment;filename=%s.xls&#x27;</span> % filename</span><br><span class="line">        wb.save(response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;需要返回一个excel文件&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="django" scheme="https://zhongkangjk.github.io/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>DJango admin 增加自定义筛选器</title>
    <link href="https://zhongkangjk.github.io/2022/04/20/DJango-admin-%E5%A2%9E%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AD%9B%E9%80%89%E5%99%A8/"/>
    <id>https://zhongkangjk.github.io/2022/04/20/DJango-admin-%E5%A2%9E%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AD%9B%E9%80%89%E5%99%A8/</id>
    <published>2022-04-20T01:09:17.000Z</published>
    <updated>2022-04-20T01:13:28.855Z</updated>
    
    <content type="html"><![CDATA[<p>增加自定义的筛选器</p><span id="more"></span><p><code>app/admin.py</code></p><h3 id="增加一个只选取月份的筛选器"><a href="#增加一个只选取月份的筛选器" class="headerlink" title="增加一个只选取月份的筛选器"></a>增加一个只选取月份的筛选器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdatedAtFilter</span>(<span class="params">admin.SimpleListFilter</span>):</span></span><br><span class="line">    title = <span class="string">&#x27;选择月份&#x27;</span></span><br><span class="line">    parameter_name = <span class="string">&#x27;月份&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 菜单列表</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lookups</span>(<span class="params">self, request, model_admin</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        List of values to allow admin to select</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        months = (</span><br><span class="line">            (<span class="number">1</span>, <span class="string">&#x27;一月&#x27;</span>),</span><br><span class="line">            (<span class="number">2</span>, <span class="string">&#x27;二月&#x27;</span>),</span><br><span class="line">            (<span class="number">3</span>, <span class="string">&#x27;三月&#x27;</span>),</span><br><span class="line">            (<span class="number">4</span>, <span class="string">&#x27;四月&#x27;</span>),</span><br><span class="line">            (<span class="number">5</span>, <span class="string">&#x27;五月&#x27;</span>),</span><br><span class="line">            (<span class="number">6</span>, <span class="string">&#x27;六月&#x27;</span>),</span><br><span class="line">            (<span class="number">7</span>, <span class="string">&#x27;七月&#x27;</span>),</span><br><span class="line">            (<span class="number">8</span>, <span class="string">&#x27;八月&#x27;</span>),</span><br><span class="line">            (<span class="number">9</span>, <span class="string">&#x27;九月&#x27;</span>),</span><br><span class="line">            (<span class="number">10</span>, <span class="string">&#x27;十月&#x27;</span>),</span><br><span class="line">            (<span class="number">11</span>, <span class="string">&#x27;十一月&#x27;</span>),</span><br><span class="line">            (<span class="number">12</span>, <span class="string">&#x27;十二月&#x27;</span>)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> months</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">queryset</span>(<span class="params">self, request, queryset</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return the filtered queryset</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.value():</span><br><span class="line">            <span class="comment"># DateTime Field can use __month to get its month value</span></span><br><span class="line">            <span class="keyword">return</span> queryset.<span class="built_in">filter</span>(到期日__month=self.value())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> queryset</span><br><span class="line"><span class="meta">@admin.register(<span class="params">催费表<span class="number">22</span>年类</span>)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> ********(<span class="params">******</span>):</span></span><br><span class="line">    list_filter = (<span class="string">&#x27;***&#x27;</span>,<span class="string">&#x27;***&#x27;</span>,<span class="string">&#x27;***&#x27;</span>,UpdatedAtFilter,) <span class="comment">#筛选器</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;增加自定义的筛选器&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="django" scheme="https://zhongkangjk.github.io/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>中文化Django自带后台名字</title>
    <link href="https://zhongkangjk.github.io/2022/04/15/%E4%B8%AD%E6%96%87%E5%8C%96Django%E8%87%AA%E5%B8%A6%E5%90%8E%E5%8F%B0%E5%90%8D%E5%AD%97/"/>
    <id>https://zhongkangjk.github.io/2022/04/15/%E4%B8%AD%E6%96%87%E5%8C%96Django%E8%87%AA%E5%B8%A6%E5%90%8E%E5%8F%B0%E5%90%8D%E5%AD%97/</id>
    <published>2022-04-15T01:36:48.000Z</published>
    <updated>2022-04-15T01:44:46.911Z</updated>
    
    <content type="html"><![CDATA[<p>自带后台各属性改中文</p><span id="more"></span><h3 id="网站标题-头"><a href="#网站标题-头" class="headerlink" title="网站标题 头"></a>网站标题 头</h3><p><code>app/admin.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line">admin.site.site_header = <span class="string">&#x27;催费&#x27;</span></span><br><span class="line">admin.site.site_title = <span class="string">&#x27;催费&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="大菜单"><a href="#大菜单" class="headerlink" title="大菜单"></a>大菜单</h3><p><code>app/__init__.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.apps <span class="keyword">import</span> AppConfig</span><br><span class="line"> </span><br><span class="line">VERBOSE_APP_NAME = <span class="string">&#x27;大菜单名字&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_current_app_name</span>(<span class="params">file</span>):</span></span><br><span class="line">    <span class="keyword">return</span> path.dirname(file).replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;/&#x27;</span>).split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppVerboseNameConfig</span>(<span class="params">AppConfig</span>):</span></span><br><span class="line">    name = get_current_app_name(__file__)</span><br><span class="line">    verbose_name = VERBOSE_APP_NAME</span><br><span class="line"> </span><br><span class="line">default_app_config = get_current_app_name(__file__) + <span class="string">&#x27;.__init__.AppVerboseNameConfig&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="小菜单"><a href="#小菜单" class="headerlink" title="小菜单"></a>小菜单</h3><p><code>app/models.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">model</span>类(<span class="params">models.Model</span>):</span></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;小菜单名字&#x27;</span></span><br><span class="line">        verbose_name_plural = <span class="string">&quot;&#x27;小菜单名字&quot;</span></span><br></pre></td></tr></table></figure><h3 id="字段名字"><a href="#字段名字" class="headerlink" title="字段名字"></a>字段名字</h3><p><code>app/models.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">model</span>类(<span class="params">models.Model</span>):</span></span><br><span class="line">age = models.CharField(<span class="string">&#x27;字段名字&#x27;</span>,max_length=<span class="number">5</span>,blank=<span class="literal">True</span>,null=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;自带后台各属性改中文&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="django" scheme="https://zhongkangjk.github.io/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>uniapp部署的网页端非主页刷新404问题的解决方案</title>
    <link href="https://zhongkangjk.github.io/2022/04/08/uniapp%E9%83%A8%E7%BD%B2%E7%9A%84%E7%BD%91%E9%A1%B5%E7%AB%AF%E9%9D%9E%E4%B8%BB%E9%A1%B5%E5%88%B7%E6%96%B0404%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>https://zhongkangjk.github.io/2022/04/08/uniapp%E9%83%A8%E7%BD%B2%E7%9A%84%E7%BD%91%E9%A1%B5%E7%AB%AF%E9%9D%9E%E4%B8%BB%E9%A1%B5%E5%88%B7%E6%96%B0404%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2022-04-08T15:16:08.000Z</published>
    <updated>2022-04-08T15:19:57.953Z</updated>
    
    <content type="html"><![CDATA[<p>在nginx增加一行</p><span id="more"></span><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">try_files</span> $uri $uri/ /index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实测么的问题，但其实我不知道为啥，无它，百度尔</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在nginx增加一行&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="前端" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="uniapp" scheme="https://zhongkangjk.github.io/tags/uniapp/"/>
    
  </entry>
  
  <entry>
    <title>合成单张发票PDF到一个PDF方便打印</title>
    <link href="https://zhongkangjk.github.io/2022/03/25/%E5%90%88%E6%88%90%E5%8D%95%E5%BC%A0%E5%8F%91%E7%A5%A8PDF%E5%88%B0%E4%B8%80%E4%B8%AAPDF%E6%96%B9%E4%BE%BF%E6%89%93%E5%8D%B0/"/>
    <id>https://zhongkangjk.github.io/2022/03/25/%E5%90%88%E6%88%90%E5%8D%95%E5%BC%A0%E5%8F%91%E7%A5%A8PDF%E5%88%B0%E4%B8%80%E4%B8%AAPDF%E6%96%B9%E4%BE%BF%E6%89%93%E5%8D%B0/</id>
    <published>2022-03-25T06:04:01.000Z</published>
    <updated>2022-03-25T06:12:38.029Z</updated>
    
    <content type="html"><![CDATA[<p>发票pdf都是占一张A4纸，给他合成到一起两张打一页</p><span id="more"></span><h3 id="转载自不知名"><a href="#转载自不知名" class="headerlink" title="转载自不知名"></a>转载自不知名</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> PyPDF2 <span class="keyword">import</span> PdfFileReader</span><br><span class="line"><span class="keyword">from</span> PyPDF2 <span class="keyword">import</span> PdfFileWriter</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;将需要转换的文件夹拖入命令行 按回车（默认为此文件所在目录）&quot;</span>)</span><br><span class="line">workpath = <span class="built_in">input</span>()</span><br><span class="line"><span class="keyword">if</span> workpath == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">    workpath = os.getcwd()</span><br><span class="line">output = os.path.join(workpath,<span class="string">&quot;合并后的.pdf&quot;</span>)</span><br><span class="line">filelist = []</span><br><span class="line"></span><br><span class="line">files = os.listdir(workpath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">    <span class="keyword">if</span> file.split(<span class="string">&#x27;.&#x27;</span>)[-<span class="number">1</span>] <span class="keyword">in</span> [<span class="string">&#x27;pdf&#x27;</span>, <span class="string">&#x27;PDF&#x27;</span>]:</span><br><span class="line">        filelist.append(os.path.join(workpath, file))</span><br><span class="line"></span><br><span class="line">filenum = <span class="built_in">len</span>(filelist)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;共找到%d个pdf文件&quot;</span> %filenum)</span><br><span class="line"> </span><br><span class="line">writer = PdfFileWriter()  <span class="comment">#实例化写类</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(filenum):</span><br><span class="line">    pageobj = PdfFileReader(filelist[i]).getPage(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> i%<span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        blankpage = writer.addBlankPage(<span class="number">610</span>,<span class="number">810</span>)</span><br><span class="line">        blankpage.mergeTranslatedPage(pageobj,<span class="number">0</span>,<span class="number">410</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        blankpage.mergeTranslatedPage(pageobj,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"><span class="comment"># writer.removeLinks() # 移除交互链接,部分发票pdf文件在位移后会有图章重复的情况,需要移除.</span></span><br><span class="line">writer.write(<span class="built_in">open</span>(output,<span class="string">&#x27;wb&#x27;</span>)) <span class="comment"># 写入新的文件,完成合并.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;转换成功 输出文件&quot;</span>,output)</span><br><span class="line"><span class="comment">#如果是在当前文件夹，最好把结果文件处理到别的地方</span></span><br><span class="line"><span class="comment">#个别发票平台移除交互链接会把签章去掉</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;发票pdf都是占一张A4纸，给他合成到一起两张打一页&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="python" scheme="https://zhongkangjk.github.io/tags/python/"/>
    
    <category term="pdf" scheme="https://zhongkangjk.github.io/tags/pdf/"/>
    
  </entry>
  
  <entry>
    <title>django导入更新数据脚本</title>
    <link href="https://zhongkangjk.github.io/2022/03/23/django%E5%AF%BC%E5%85%A5%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E8%84%9A%E6%9C%AC/"/>
    <id>https://zhongkangjk.github.io/2022/03/23/django%E5%AF%BC%E5%85%A5%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E8%84%9A%E6%9C%AC/</id>
    <published>2022-03-23T06:35:07.000Z</published>
    <updated>2022-03-23T07:08:09.072Z</updated>
    
    <content type="html"><![CDATA[<p>把操作django数据库的导入更新操作汇总一下以备参考</p><span id="more"></span><h3 id="之前利用爬虫更新表内数据和用时间计算表数据的日更操作脚本"><a href="#之前利用爬虫更新表内数据和用时间计算表数据的日更操作脚本" class="headerlink" title="之前利用爬虫更新表内数据和用时间计算表数据的日更操作脚本"></a>之前利用爬虫更新表内数据和用时间计算表数据的日更操作脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os,sys,django</span><br><span class="line"><span class="keyword">import</span> asyncio,datetime,calendar</span><br><span class="line"><span class="keyword">import</span> httpx,json,time,math</span><br><span class="line"><span class="keyword">from</span> dateutil.relativedelta <span class="keyword">import</span> relativedelta</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> email.mime.application <span class="keyword">import</span> MIMEApplication</span><br><span class="line">project_path = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.append(project_path)</span><br><span class="line">os.environ[<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>] = <span class="string">&#x27;shuai4.settings&#x27;</span></span><br><span class="line">django.setup()</span><br><span class="line"><span class="keyword">from</span> cuifei.models <span class="keyword">import</span> 催费表类,可收表<span class="number">19</span>年,可收表<span class="number">20</span>年</span><br><span class="line"><span class="keyword">from</span> shuju.models <span class="keyword">import</span> 数据通知表类</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> 取结果(<span class="params">r</span>):</span></span><br><span class="line">    <span class="keyword">if</span> r[<span class="string">&#x27;obj&#x27;</span>]:</span><br><span class="line">        j = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> r[<span class="string">&#x27;obj&#x27;</span>]:</span><br><span class="line">            j.append(i[<span class="string">&#x27;fwqx&#x27;</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(j),r[<span class="string">&#x27;obj&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;jbrdh&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>,<span class="literal">None</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;bearer eyJhbGciOiJIUzI1NiJ9.eyJp***&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url_by_税号 = <span class="string">&#x27;http://***&#x27;</span></span><br><span class="line">查税号URL= <span class="string">&#x27;http://***&#x27;</span></span><br><span class="line"></span><br><span class="line">文本 = []</span><br><span class="line"><span class="comment"># print(催费表类.objects.all()[:5])</span></span><br><span class="line">queryset = 催费表类.objects.<span class="built_in">all</span>()</span><br><span class="line"><span class="function"><span class="keyword">def</span> 更新到期日和时间(<span class="params">queryset</span>):</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> 爬(<span class="params">client,body</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> 保存结果(<span class="params">结果,body</span>):</span></span><br><span class="line">            <span class="keyword">if</span> 结果[<span class="number">0</span>]:</span><br><span class="line">                body.到期日 = 结果[<span class="number">0</span>]</span><br><span class="line">                <span class="comment"># body.经办人电话 = 结果[1]</span></span><br><span class="line">                body.save(update_fields=[<span class="string">&#x27;到期日&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        r = <span class="keyword">await</span> client.post(url_by_税号,headers=headers, data=json.dumps(&#123;<span class="string">&#x27;khsbh&#x27;</span>: body.税号,&#125;),timeout=<span class="literal">None</span>)</span><br><span class="line">        结果 = 取结果(r.json())</span><br><span class="line">        <span class="keyword">if</span> 结果[<span class="number">0</span>]:</span><br><span class="line">            保存结果(结果,body)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            用名称查的data = json.dumps(&#123;<span class="string">&#x27;count&#x27;</span>:<span class="number">100</span>,<span class="string">&#x27;keyword&#x27;</span>: body.公司名称,<span class="string">&#x27;page&#x27;</span>:<span class="number">0</span>&#125;)</span><br><span class="line">            r = <span class="keyword">await</span> client.post(查税号URL,headers=headers, data=用名称查的data,timeout=<span class="literal">None</span>)</span><br><span class="line">            res_dict = r.json()</span><br><span class="line">            <span class="keyword">if</span> res_dict[<span class="string">&#x27;obj&#x27;</span>]:</span><br><span class="line">                税号<span class="number">1</span> = res_dict[<span class="string">&#x27;obj&#x27;</span>][-<span class="number">1</span>][<span class="string">&#x27;khsbh&#x27;</span>]</span><br><span class="line">                r1 = <span class="keyword">await</span> client.post(url_by_税号,headers=headers, data=json.dumps(&#123;<span class="string">&#x27;khsbh&#x27;</span>: 税号<span class="number">1</span>,&#125;),timeout=<span class="literal">None</span>)</span><br><span class="line">                结果<span class="number">1</span> = 取结果(r1.json())</span><br><span class="line">                保存结果(结果<span class="number">1</span>,body)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span>,<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> 跑():</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> httpx.AsyncClient() <span class="keyword">as</span> client:</span><br><span class="line">            task_list = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> queryset:</span><br><span class="line">                req = 爬(client,i)</span><br><span class="line">                task = asyncio.create_task(req)</span><br><span class="line">                task_list.append(task)</span><br><span class="line">            <span class="keyword">await</span> asyncio.gather(*task_list)</span><br><span class="line">    start = time.time()</span><br><span class="line">    asyncio.run(跑())</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(end-start)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;查日期完成于&#x27;</span>+time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime()))</span><br><span class="line">    文本.append(<span class="string">&#x27;查日期完成于&#x27;</span>+time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime())+<span class="string">&#x27;用时&#x27;</span>+<span class="built_in">str</span>(end-start)+<span class="string">&#x27;秒&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> 更新可收年份(<span class="params">queryset</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> queryset:</span><br><span class="line">        <span class="keyword">if</span> i.到期日:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">type</span>(i.到期日) == <span class="built_in">type</span>(<span class="string">&#x27;s&#x27;</span>):</span><br><span class="line">                到期日 = datetime.datetime.strptime(i.到期日,<span class="string">&#x27;%Y-%m-%d&#x27;</span>).date()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                到期日 = i.到期日</span><br><span class="line">            <span class="comment"># print(i.公司名称,i.税号)</span></span><br><span class="line">            a = 可收表<span class="number">19</span>年.objects.<span class="built_in">filter</span>(公司名称__exact = i.公司名称).count()</span><br><span class="line">            <span class="keyword">if</span> a &gt; <span class="number">0</span>:</span><br><span class="line">                i.可收<span class="number">19</span> = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i.可收<span class="number">19</span> = <span class="number">0</span></span><br><span class="line">            b = 可收表<span class="number">20</span>年.objects.<span class="built_in">filter</span>(Q(公司名称__exact = i.公司名称)|Q(税号__exact = i.税号)).count()</span><br><span class="line">            <span class="keyword">if</span> b &gt; <span class="number">0</span>:</span><br><span class="line">                i.可收<span class="number">20</span> = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i.可收<span class="number">20</span> = <span class="number">0</span></span><br><span class="line">            <span class="comment"># print(i.到期日)</span></span><br><span class="line">            <span class="comment"># print(datetime.date.today())</span></span><br><span class="line">            年 = datetime.datetime.now().year</span><br><span class="line">            月 = datetime.datetime.now().month</span><br><span class="line">            下一个月 = (datetime.datetime.now()+relativedelta(months=<span class="number">1</span>)).month</span><br><span class="line">            <span class="comment"># 日 = datetime.datetime.now().day</span></span><br><span class="line">            新日 = calendar.monthrange(年,下一个月)[<span class="number">1</span>]</span><br><span class="line">            <span class="comment"># print(新日)</span></span><br><span class="line">            <span class="comment"># print(datetime.date(年,月,新日)==i.到期日)</span></span><br><span class="line">            <span class="keyword">if</span> datetime.date(年,下一个月,新日)==到期日:</span><br><span class="line">                差年= <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                差年 = math.ceil((datetime.date(年,下一个月,新日)-到期日)/datetime.timedelta(days=<span class="number">365</span>))</span><br><span class="line">            <span class="comment"># print(差年)</span></span><br><span class="line">            到期日年份 = 到期日.year</span><br><span class="line">            可收字典 = &#123;<span class="number">2015</span>:<span class="number">1</span>,<span class="number">2016</span>:<span class="number">1</span>,<span class="number">2017</span>:<span class="number">1</span>,<span class="number">2018</span>:<span class="number">1</span>,<span class="number">2019</span>:i.可收<span class="number">19</span>,<span class="number">2020</span>:i.可收<span class="number">20</span>,<span class="number">2021</span>:<span class="number">1</span>&#125;</span><br><span class="line">            <span class="comment"># 年份 = sum(listn[:差年])</span></span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i1 <span class="keyword">in</span> <span class="built_in">range</span>(到期日年份,到期日年份+差年):</span><br><span class="line">                <span class="comment"># print(i1)</span></span><br><span class="line">                j += 可收字典[i1]</span><br><span class="line">            <span class="comment"># print(j)</span></span><br><span class="line">            i.几年 = j</span><br><span class="line">            i.save(update_fields=[<span class="string">&#x27;可收19&#x27;</span>,<span class="string">&#x27;可收20&#x27;</span>,<span class="string">&#x27;几年&#x27;</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;查可收几年完成于&#x27;</span>+time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime()))</span><br><span class="line">    <span class="comment"># global d</span></span><br><span class="line">    <span class="comment"># d = (&#x27;\n&#x27;+&#x27;查可收几年完成于&#x27;+time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, time.localtime()))</span></span><br><span class="line">    文本.append(<span class="string">&#x27;查可收几年完成于&#x27;</span>+time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime()))</span><br><span class="line">更新到期日和时间(queryset)</span><br><span class="line">更新可收年份(queryset)</span><br><span class="line"><span class="function"><span class="keyword">def</span> 发送邮件(<span class="params">邮件标题,称呼,邮件文字,发件人邮箱,密码,收件人邮箱,附件路径列表,附件命名列表</span>):</span></span><br><span class="line">    msg = MIMEMultipart()</span><br><span class="line">    msg[<span class="string">&quot;Subject&quot;</span>] = 邮件标题</span><br><span class="line">    msg[<span class="string">&quot;From&quot;</span>]    = 发件人邮箱  </span><br><span class="line">    msg[<span class="string">&quot;To&quot;</span>]      = 称呼</span><br><span class="line">    <span class="comment">#这是文字部分</span></span><br><span class="line">    part = MIMEText(邮件文字)</span><br><span class="line">    msg.attach(part)</span><br><span class="line">    <span class="comment">#这是附件部分</span></span><br><span class="line">    <span class="keyword">for</span> 附件路径,附件命名 <span class="keyword">in</span> <span class="built_in">zip</span>(附件路径列表,附件命名列表):</span><br><span class="line">        part = MIMEApplication(<span class="built_in">open</span>(附件路径,<span class="string">&#x27;rb&#x27;</span>).read())</span><br><span class="line">        part.add_header(<span class="string">&#x27;Content-Disposition&#x27;</span>, <span class="string">&#x27;attachment&#x27;</span>, filename=附件命名)</span><br><span class="line">        msg.attach(part)</span><br><span class="line"></span><br><span class="line">    s = smtplib.SMTP(<span class="string">&quot;smtp.qq.com&quot;</span>, timeout=<span class="number">60</span>)<span class="comment">#SMTP服务的网址</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s.login(发件人邮箱, 密码)</span><br><span class="line">        s.sendmail(发件人邮箱, 收件人邮箱, msg.as_string())<span class="comment">#收件人邮箱可以是列表</span></span><br><span class="line">        s.close()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;发送成功&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;发送失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> 拿昨天的老数据(<span class="params">区域</span>):</span></span><br><span class="line">    <span class="comment"># 今天 = datetime.date.today()</span></span><br><span class="line">    昨天 = datetime.date.today() - datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># print(昨天)</span></span><br><span class="line">    <span class="comment"># print(type(昨天))</span></span><br><span class="line">    a = 数据通知表类.objects.<span class="built_in">filter</span>(Q(日期 = 昨天)&amp;Q(区域=区域)).values()[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># for i in a:</span></span><br><span class="line">    <span class="comment">#     print(i)</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">崂山老数据字典 = 拿昨天的老数据(<span class="string">&#x27;崂山&#x27;</span>)</span><br><span class="line">市南老数据字典 = 拿昨天的老数据(<span class="string">&#x27;市南&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> 获得今天的新数据并存数据库(<span class="params">区域</span>):</span></span><br><span class="line">    <span class="comment"># 崂山</span></span><br><span class="line">    今天 = datetime.date.today()</span><br><span class="line">    能查到日期的户数 = 催费表类.objects.<span class="built_in">filter</span>(Q(到期日__isnull=<span class="literal">False</span>)&amp;Q(区域=区域)).count()</span><br><span class="line">    查不到日期的户数 = 催费表类.objects.<span class="built_in">filter</span>(Q(到期日__isnull=<span class="literal">True</span>)&amp;Q(区域=区域)).count()</span><br><span class="line">    年 = datetime.datetime.now().year</span><br><span class="line">    月 = datetime.datetime.now().month</span><br><span class="line">    日 = calendar.monthrange(年,月)[<span class="number">1</span>]</span><br><span class="line">    下一个月 = (datetime.datetime.now()+relativedelta(months=<span class="number">1</span>)).month</span><br><span class="line">    下一个月日 = calendar.monthrange(年,下一个月)[<span class="number">1</span>]</span><br><span class="line">    到期日为当月的户数 = 催费表类.objects.<span class="built_in">filter</span>(Q(到期日__<span class="built_in">range</span>=(datetime.date(年, 月, <span class="number">1</span>),datetime.date(年, 月, 日)))&amp;Q(区域=区域)).count()</span><br><span class="line">    到期日为下月的户数 = 催费表类.objects.<span class="built_in">filter</span>(Q(到期日__<span class="built_in">range</span>=(datetime.date(年, 下一个月, <span class="number">1</span>),datetime.date(年, 下一个月,下一个月日)))&amp;Q(区域=区域)).count()</span><br><span class="line">    前一个月 = (datetime.datetime.now()-relativedelta(months=<span class="number">1</span>)).month</span><br><span class="line">    新日 = calendar.monthrange(年,前一个月)[<span class="number">1</span>]</span><br><span class="line">    今年已逾期的户数 = 催费表类.objects.<span class="built_in">filter</span>(Q(到期日__<span class="built_in">range</span>=(datetime.date(年, <span class="number">1</span>, <span class="number">1</span>),datetime.date(年, 前一个月, 新日)))&amp;Q(区域=区域)).count()</span><br><span class="line">    下两个月 = (datetime.datetime.now()+relativedelta(months=<span class="number">2</span>)).month</span><br><span class="line">    今年还未到期的户数 = 催费表类.objects.<span class="built_in">filter</span>(Q(到期日__<span class="built_in">range</span>=(datetime.date(年,下两个月, <span class="number">1</span>),datetime.date(年, <span class="number">12</span>, <span class="number">31</span>)))&amp;Q(区域=区域)).count()</span><br><span class="line">    往年到期户 = 催费表类.objects.<span class="built_in">filter</span>(Q(到期日__lt=datetime.date(年,<span class="number">1</span>,<span class="number">1</span>))&amp;Q(几年__gte=<span class="number">1</span>)&amp;Q(区域=区域)).count()</span><br><span class="line">    更新数据 = &#123;</span><br><span class="line">        <span class="string">&#x27;日期&#x27;</span>:今天,</span><br><span class="line">        <span class="string">&#x27;区域&#x27;</span>:区域,</span><br><span class="line">        <span class="string">&#x27;能查到日期的户数&#x27;</span>:能查到日期的户数,</span><br><span class="line">        <span class="string">&#x27;查不到日期的户数&#x27;</span>:查不到日期的户数,</span><br><span class="line">        <span class="string">&#x27;到期日为当月的户数&#x27;</span>:到期日为当月的户数,</span><br><span class="line">        <span class="string">&#x27;到期日为下月的户数&#x27;</span>:到期日为下月的户数,</span><br><span class="line">        <span class="string">&#x27;今年已逾期的户数&#x27;</span>:今年已逾期的户数,</span><br><span class="line">        <span class="string">&#x27;今年还未到期的户数&#x27;</span>:今年还未到期的户数,</span><br><span class="line">        <span class="string">&#x27;往年到期户&#x27;</span>:往年到期户</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#存数据</span></span><br><span class="line">    数据通知表类.objects.update_or_create(defaults=更新数据,日期=今天,区域=区域)</span><br><span class="line">    a = 数据通知表类.objects.<span class="built_in">filter</span>(Q(日期 = 今天)&amp;Q(区域=区域)).values()[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># print(a)</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">崂山新数据字典 = 获得今天的新数据并存数据库(<span class="string">&#x27;崂山&#x27;</span>)</span><br><span class="line">市南新数据字典 = 获得今天的新数据并存数据库(<span class="string">&#x27;市南&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> 增加数据(<span class="params">区域,新数据字典,老数据字典</span>):</span></span><br><span class="line">    文本.append(区域)</span><br><span class="line">    文本.append(<span class="string">&#x27;能查到日期的户数：&#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;能查到日期的户数&#x27;</span>])+<span class="string">&#x27;户  &#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;能查到日期的户数&#x27;</span>]-老数据字典[<span class="string">&#x27;能查到日期的户数&#x27;</span>]))</span><br><span class="line">    文本.append(<span class="string">&#x27;查不到日期的户数：&#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;查不到日期的户数&#x27;</span>])+<span class="string">&#x27;户  &#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;查不到日期的户数&#x27;</span>]-老数据字典[<span class="string">&#x27;查不到日期的户数&#x27;</span>]))</span><br><span class="line">    文本.append(<span class="string">&#x27;到期日为当月的户数：&#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;到期日为当月的户数&#x27;</span>])+<span class="string">&#x27;户  &#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;到期日为当月的户数&#x27;</span>]-老数据字典[<span class="string">&#x27;到期日为当月的户数&#x27;</span>]))</span><br><span class="line">    文本.append(<span class="string">&#x27;到期日为下月的户数：&#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;到期日为下月的户数&#x27;</span>])+<span class="string">&#x27;户  &#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;到期日为下月的户数&#x27;</span>]-老数据字典[<span class="string">&#x27;到期日为下月的户数&#x27;</span>]))</span><br><span class="line">    文本.append(<span class="string">&#x27;今年已逾期的户数：&#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;今年已逾期的户数&#x27;</span>])+<span class="string">&#x27;户  &#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;今年已逾期的户数&#x27;</span>]-老数据字典[<span class="string">&#x27;今年已逾期的户数&#x27;</span>]))</span><br><span class="line">    <span class="comment"># 文本.append(&#x27;今年还未到期的户数：&#x27;+str(新数据字典[&#x27;今年还未到期的户数&#x27;])+&#x27;户  &#x27;+str(新数据字典[&#x27;今年还未到期的户数&#x27;]-老数据字典[&#x27;今年还未到期的户数&#x27;]))</span></span><br><span class="line">    文本.append(<span class="string">&#x27;往年到期户：&#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;往年到期户&#x27;</span>])+<span class="string">&#x27;户  &#x27;</span>+<span class="built_in">str</span>(新数据字典[<span class="string">&#x27;往年到期户&#x27;</span>]-老数据字典[<span class="string">&#x27;往年到期户&#x27;</span>]))</span><br><span class="line">增加数据(<span class="string">&#x27;崂山&#x27;</span>,崂山新数据字典,崂山老数据字典)</span><br><span class="line">增加数据(<span class="string">&#x27;市南&#x27;</span>,市南新数据字典,市南老数据字典)</span><br><span class="line"></span><br><span class="line">c = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 文本:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    c += (<span class="string">&#x27;\n&#x27;</span>+i)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">发送邮件(<span class="string">&#x27;更新通知&#x27;</span>,<span class="string">&#x27;崂山&#x27;</span>,c,<span class="string">&#x27;**&#x27;</span>,<span class="string">&#x27;**&#x27;</span>,[<span class="string">&#x27;**&#x27;</span>,<span class="string">&#x27;**&#x27;</span>],<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="删除数据的脚本"><a href="#删除数据的脚本" class="headerlink" title="删除数据的脚本"></a>删除数据的脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> os,sys,django</span><br><span class="line"><span class="keyword">import</span> xlrd</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> 打开<span class="title">excel</span>文件():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,文件名,第几个表</span>):</span></span><br><span class="line">        self.文件 = xlrd.open_workbook(filename = 文件名)</span><br><span class="line">        self.表 = self.文件.sheet_by_index(第几个表-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> 获得横向资料(<span class="params">self</span>):</span></span><br><span class="line">        self.数据 = [self.表.row_values(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.表.nrows)]</span><br><span class="line">        <span class="keyword">return</span> self.数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> 获得纵向资料(<span class="params">self</span>):</span></span><br><span class="line">        self.数据 =  [self.表.col_values(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.表.ncols)]</span><br><span class="line">        <span class="keyword">return</span> self.数据</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> 获得名称列数据(<span class="params">self,名称</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> 获得列序号(<span class="params">表名,查找字段名</span>):</span></span><br><span class="line">            列序号 = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(表名.ncols):</span><br><span class="line">                <span class="keyword">if</span> (表名.cell_value(<span class="number">0</span>,i) == 查找字段名):</span><br><span class="line">                    列序号 = i</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">return</span> 列序号</span><br><span class="line">        <span class="built_in">print</span>(获得列序号(self.表,名称))</span><br><span class="line">        self.数据 = self.表.col_values(获得列序号(self.表,名称),<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> self.数据</span><br><span class="line">文件 = 打开excel文件(<span class="string">&#x27;市南可收费注销.xls&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">list1 = 文件.获得名称列数据(<span class="string">&#x27;单位名称&#x27;</span>)</span><br><span class="line"></span><br><span class="line">project_path = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.append(project_path)</span><br><span class="line">os.environ[<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>] = <span class="string">&#x27;shuai4.settings&#x27;</span></span><br><span class="line">django.setup()</span><br><span class="line"><span class="keyword">from</span> cuifei.models <span class="keyword">import</span> 催费表类</span><br><span class="line"></span><br><span class="line">催费表类.objects.<span class="built_in">filter</span>(公司名称__<span class="keyword">in</span>=list1).delete()</span><br></pre></td></tr></table></figure><h3 id="填充数据的脚本"><a href="#填充数据的脚本" class="headerlink" title="填充数据的脚本"></a>填充数据的脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> os,sys,django</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> 提取类():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,文件名,第几个表</span>):</span></span><br><span class="line">        self.文件 = pd.read_excel(文件名, 第几个表)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> 拿取数据(<span class="params">self,从第几行开始,*列名</span>):</span></span><br><span class="line">        self.数据 = self.文件.loc[从第几行开始-<span class="number">2</span>:,[*列名,]]</span><br><span class="line">        <span class="comment">#print(self.数据)</span></span><br><span class="line">        <span class="keyword">return</span> self.数据</span><br><span class="line"></span><br><span class="line">销售表 = 提取类(<span class="string">&#x27;不可收名单.xls&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">销售数据 = 销售表.拿取数据(<span class="number">2</span>,<span class="string">&#x27;纳税人识别号&#x27;</span>,<span class="string">&#x27;纳税人名称&#x27;</span>)</span><br><span class="line">销售数据 = 销售数据.values.tolist()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">project_path = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.append(project_path)</span><br><span class="line">os.environ[<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>] = <span class="string">&#x27;shuai4.settings&#x27;</span></span><br><span class="line">django.setup()</span><br><span class="line"><span class="keyword">from</span> cuifei.models <span class="keyword">import</span> 催费表<span class="number">22</span>年类</span><br><span class="line"><span class="comment"># 催费表22年类.objects.all().update(是否可收=&#x27;可收&#x27;)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 销售数据:</span><br><span class="line">    <span class="keyword">if</span> 催费表<span class="number">22</span>年类.objects.<span class="built_in">filter</span>(税号=i[<span class="number">0</span>]):</span><br><span class="line">        催费表<span class="number">22</span>年类.objects.<span class="built_in">filter</span>(税号=i[<span class="number">0</span>]).update(是否可收=<span class="string">&#x27;不可收&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(i[<span class="number">1</span>]+<span class="string">&#x27;,通过税号确定不可收&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> 催费表<span class="number">22</span>年类.objects.<span class="built_in">filter</span>(公司名称=i[<span class="number">1</span>]):</span><br><span class="line">            催费表<span class="number">22</span>年类.objects.<span class="built_in">filter</span>(公司名称=i[<span class="number">1</span>]).update(是否可收=<span class="string">&#x27;不可收&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(i[<span class="number">1</span>]+<span class="string">&#x27;通过名称确定不可收&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(i[<span class="number">1</span>]+<span class="string">&#x27;发行表没有的不可收企业&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="批量导入数据脚本"><a href="#批量导入数据脚本" class="headerlink" title="批量导入数据脚本"></a>批量导入数据脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> os,sys,django</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> 提取类():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,文件名,第几个表</span>):</span></span><br><span class="line">        self.文件 = pd.read_excel(文件名, 第几个表)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> 拿取数据(<span class="params">self,从第几行开始,*列名</span>):</span></span><br><span class="line">        self.数据 = self.文件.loc[从第几行开始-<span class="number">2</span>:,[*列名,]]</span><br><span class="line">        <span class="comment">#print(self.数据)</span></span><br><span class="line">        <span class="keyword">return</span> self.数据</span><br><span class="line"></span><br><span class="line">销售表 = 提取类(<span class="string">&#x27;导入模板.xlsx&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">销售数据 = 销售表.拿取数据(<span class="number">2</span>,<span class="string">&#x27;公司名称&#x27;</span>,<span class="string">&#x27;区域&#x27;</span>,<span class="string">&#x27;税号&#x27;</span>,<span class="string">&#x27;性质&#x27;</span>)</span><br><span class="line">销售数据 = 销售数据.values.tolist()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">project_path = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.append(project_path)</span><br><span class="line">os.environ[<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>] = <span class="string">&#x27;shuai4.settings&#x27;</span></span><br><span class="line">django.setup()</span><br><span class="line"><span class="keyword">from</span> cuifei.models <span class="keyword">import</span> 催费表类</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span> = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 销售数据:</span><br><span class="line">    <span class="comment"># print(i[4])</span></span><br><span class="line">    <span class="built_in">list</span>.append(催费表类(公司名称 = i[<span class="number">0</span>],区域 = i[<span class="number">1</span>],税号 = i[<span class="number">2</span>],性质 = i[<span class="number">3</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">催费表类.objects.bulk_create(<span class="built_in">list</span>)</span><br></pre></td></tr></table></figure><h3 id="更新某一列数据脚本"><a href="#更新某一列数据脚本" class="headerlink" title="更新某一列数据脚本"></a>更新某一列数据脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> os,sys,django</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> 提取类():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,文件名,第几个表</span>):</span></span><br><span class="line">        self.文件 = pd.read_excel(文件名, 第几个表)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> 拿取数据(<span class="params">self,从第几行开始,*列名</span>):</span></span><br><span class="line">        self.数据 = self.文件.loc[从第几行开始-<span class="number">2</span>:,[*列名,]]</span><br><span class="line">        <span class="comment">#print(self.数据)</span></span><br><span class="line">        <span class="keyword">return</span> self.数据</span><br><span class="line"></span><br><span class="line">销售表 = 提取类(<span class="string">&#x27;/www/wwwroot/shuai4-django-env3.7/shuai4-django/时间.xls&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">销售数据 = 销售表.拿取数据(<span class="number">2</span>,<span class="string">&#x27;税号&#x27;</span>,<span class="string">&#x27;名称&#x27;</span>,<span class="string">&#x27;服务期限&#x27;</span>)</span><br><span class="line">销售数据 = 销售数据.values.tolist()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">project_path = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.append(project_path)</span><br><span class="line">os.environ[<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>] = <span class="string">&#x27;shuai4.settings&#x27;</span></span><br><span class="line">django.setup()</span><br><span class="line"><span class="keyword">from</span> cuifei.models <span class="keyword">import</span> 催费表<span class="number">22</span>年类</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 销售数据:</span><br><span class="line">    <span class="keyword">if</span> 催费表<span class="number">22</span>年类.objects.<span class="built_in">filter</span>(税号=i[<span class="number">0</span>]):</span><br><span class="line">        催费表<span class="number">22</span>年类.objects.<span class="built_in">filter</span>(税号=i[<span class="number">0</span>]).update(到期日=i[<span class="number">2</span>])</span><br><span class="line">        <span class="built_in">print</span>(i[<span class="number">0</span>]+<span class="string">&#x27;成功&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> 催费表<span class="number">22</span>年类.objects.<span class="built_in">filter</span>(公司名称=i[<span class="number">1</span>]):</span><br><span class="line">            催费表<span class="number">22</span>年类.objects.<span class="built_in">filter</span>(公司名称=i[<span class="number">1</span>]).update(到期日=i[<span class="number">2</span>])</span><br><span class="line">            <span class="built_in">print</span>(i[<span class="number">0</span>]+<span class="string">&#x27;成功&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(i[<span class="number">0</span>]+<span class="string">&#x27;失败&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;把操作django数据库的导入更新操作汇总一下以备参考&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="python" scheme="https://zhongkangjk.github.io/tags/python/"/>
    
    <category term="django" scheme="https://zhongkangjk.github.io/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>使用易即今日API定时更新每日新闻图片</title>
    <link href="https://zhongkangjk.github.io/2022/03/09/%E4%BD%BF%E7%94%A8%E6%98%93%E5%8D%B3%E4%BB%8A%E6%97%A5API%E5%AE%9A%E6%97%B6%E6%9B%B4%E6%96%B0%E6%AF%8F%E6%97%A5%E6%96%B0%E9%97%BB%E5%9B%BE%E7%89%87/"/>
    <id>https://zhongkangjk.github.io/2022/03/09/%E4%BD%BF%E7%94%A8%E6%98%93%E5%8D%B3%E4%BB%8A%E6%97%A5API%E5%AE%9A%E6%97%B6%E6%9B%B4%E6%96%B0%E6%AF%8F%E6%97%A5%E6%96%B0%E9%97%BB%E5%9B%BE%E7%89%87/</id>
    <published>2022-03-09T08:05:24.000Z</published>
    <updated>2022-03-09T08:08:21.159Z</updated>
    
    <content type="html"><![CDATA[<p>更新脚本和定时任务</p><span id="more"></span><p>news-updated.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://api.soyiji.com//news_jpg&quot;</span></span><br><span class="line">response = requests.request(<span class="string">&quot;GET&quot;</span>, url)</span><br><span class="line">res = <span class="built_in">eval</span>(response.text)</span><br><span class="line">图片地址 = res[<span class="string">&#x27;url&#x27;</span>]</span><br><span class="line">headers = &#123;  <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;safe.soyiji.com&#x27;</span>&#125;</span><br><span class="line">response = requests.request(<span class="string">&quot;GET&quot;</span>, 图片地址, headers=headers)</span><br><span class="line"><span class="comment"># 图片文件保存</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/www/wwwroot/shuai4-django-env3.7/shuai4-django/collected_static/1.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response.content)</span><br></pre></td></tr></table></figure><p>由于文件夹已经受nginx管理，不需要其他操作</p><p>绝对路径执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/www/wwwroot/shuai4-django-env3.7/bin/python /www/wwwroot/shuai4-django-env3.7/shuai4-django/news-updated.py</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;更新脚本和定时任务&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="python" scheme="https://zhongkangjk.github.io/tags/python/"/>
    
    <category term="爬虫" scheme="https://zhongkangjk.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>Django日常操作</title>
    <link href="https://zhongkangjk.github.io/2022/03/09/Django%E6%97%A5%E5%B8%B8%E6%93%8D%E4%BD%9C/"/>
    <id>https://zhongkangjk.github.io/2022/03/09/Django%E6%97%A5%E5%B8%B8%E6%93%8D%E4%BD%9C/</id>
    <published>2022-03-09T07:52:21.000Z</published>
    <updated>2022-03-23T06:31:53.731Z</updated>
    
    <content type="html"><![CDATA[<p>日常复制</p><span id="more"></span><h4 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h4><p><code>django-admin startproject 项目名字</code></p><h4 id="创建APP"><a href="#创建APP" class="headerlink" title="创建APP"></a>创建APP</h4><p><code>python manage.py startapp APP名字</code></p><h4 id="创建APP以后"><a href="#创建APP以后" class="headerlink" title="创建APP以后"></a>创建APP以后</h4><p>settings中增加INSTALLED_APPS,<br>APP内增加分url</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 引入path</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正在部署的应用的名称</span></span><br><span class="line">app_name = <span class="string">&#x27;APP名称&#x27;</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 目前还没有urls</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>总url引入分url</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 新增代码，配置app的url</span></span><br><span class="line">    path(<span class="string">&#x27;定义url/&#x27;</span>, include(<span class="string">&#x27;APP名称.urls&#x27;</span>, namespace=<span class="string">&#x27;APP名称&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="写API函数"><a href="#写API函数" class="headerlink" title="写API函数"></a>写API函数</h4><p>分url</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> APP名称 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">app_name = <span class="string">&#x27;APP名称&#x27;</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;list/&#x27;</span>,views.hellolist),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>views</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.decorators <span class="keyword">import</span> api_view</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line"><span class="meta">@api_view(<span class="params">[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hellolist</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="built_in">list</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">    <span class="keyword">return</span> Response(<span class="built_in">list</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常复制&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="django" scheme="https://zhongkangjk.github.io/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>Django伪监控小脚本</title>
    <link href="https://zhongkangjk.github.io/2022/03/09/Django%E4%BC%AA%E7%9B%91%E6%8E%A7%E5%B0%8F%E8%84%9A%E6%9C%AC/"/>
    <id>https://zhongkangjk.github.io/2022/03/09/Django%E4%BC%AA%E7%9B%91%E6%8E%A7%E5%B0%8F%E8%84%9A%E6%9C%AC/</id>
    <published>2022-03-09T07:10:51.000Z</published>
    <updated>2022-03-23T06:31:55.826Z</updated>
    
    <content type="html"><![CDATA[<p>在django加个小模块来监控别的电脑情况以及执行指令</p><span id="more"></span><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#主url</span></span><br><span class="line">path(<span class="string">&#x27;utils/&#x27;</span>, include(<span class="string">&#x27;utils.urls&#x27;</span>)),</span><br><span class="line"><span class="comment">#分url</span></span><br><span class="line">path(<span class="string">&#x27;xinxiview/&#x27;</span>,views.XinxiView.as_view()),</span><br><span class="line">path(<span class="string">&#x27;zhilingview/&#x27;</span>,views.ZhilingView.as_view()),</span><br><span class="line"><span class="comment">#model</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dictionary</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="comment"># 字典名称 不可重复</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># 字典内容</span></span><br><span class="line">    data = models.TextField(blank=<span class="literal">True</span>,null=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"><span class="comment">#view</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XinxiView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="comment"># permission_classes = [IsAuthenticated]</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, <span class="built_in">format</span>=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="comment">#获得model Dictionary里名称为税控盘信息的内容</span></span><br><span class="line">        税控盘信息 = Dictionary.objects.get(name=<span class="string">&#x27;税控盘信息&#x27;</span>).data</span><br><span class="line">        UK信息 = Dictionary.objects.get(name=<span class="string">&#x27;UK信息&#x27;</span>).data</span><br><span class="line">        税控盘信息 = 税控盘信息.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        UK信息 = UK信息.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        信息列表 = [税控盘信息,UK信息]</span><br><span class="line">        <span class="keyword">return</span> Response(信息列表)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, <span class="built_in">format</span>=<span class="literal">None</span></span>):</span></span><br><span class="line">        name = request.data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        xinxi = request.data.get(<span class="string">&#x27;xinxi&#x27;</span>)</span><br><span class="line">        <span class="comment"># 更改Directory里name为name的body为xinxi</span></span><br><span class="line">        Dictionary.objects.<span class="built_in">filter</span>(name=name).update(data=xinxi)</span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&#x27;更新成功&#x27;</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZhilingView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="comment"># permission_classes = [IsAuthenticated]</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, <span class="built_in">format</span>=<span class="literal">None</span></span>):</span></span><br><span class="line">        name = request.query_params.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        <span class="comment"># 获得model Dictionary里名称为name的body</span></span><br><span class="line">        zhiling = Dictionary.objects.get(name=name).data</span><br><span class="line">        Dictionary.objects.<span class="built_in">filter</span>(name=name).update(data=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(zhiling)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, <span class="built_in">format</span>=<span class="literal">None</span></span>):</span></span><br><span class="line">        zhiling1 = request.data.get(<span class="string">&#x27;税控盘指令&#x27;</span>)</span><br><span class="line">        zhiling2 = request.data.get(<span class="string">&#x27;UK指令&#x27;</span>)</span><br><span class="line">        <span class="comment"># 更改Directory里name为name的body为xinxi</span></span><br><span class="line">        Dictionary.objects.<span class="built_in">filter</span>(name=<span class="string">&#x27;税控盘指令&#x27;</span>).update(data=zhiling1)</span><br><span class="line">        Dictionary.objects.<span class="built_in">filter</span>(name=<span class="string">&#x27;UK指令&#x27;</span>).update(data=zhiling2)</span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&#x27;更新指令成功&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="被监控端更新数据-amp-执行命令"><a href="#被监控端更新数据-amp-执行命令" class="headerlink" title="被监控端更新数据&amp;执行命令"></a>被监控端更新数据&amp;执行命令</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,os,time,json</span><br><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line">xinxiurl = <span class="string">&#x27;http://###/utils/xinxiview/&#x27;</span></span><br><span class="line">zhilingurl = <span class="string">&#x27;http://###/utils/zhilingview/&#x27;</span></span><br><span class="line"><span class="comment"># 检测进程是否存在的函数 </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_process</span>(<span class="params">process_name</span>):</span></span><br><span class="line">    <span class="keyword">for</span> proc <span class="keyword">in</span> psutil.process_iter():</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 检查进程名称返回进程对象</span></span><br><span class="line">            <span class="keyword">if</span> process_name <span class="keyword">in</span> proc.name():</span><br><span class="line">                <span class="keyword">return</span> proc.pid</span><br><span class="line">        <span class="keyword">except</span> (psutil.NoSuchProcess, psutil.AccessDenied, psutil.ZombieProcess):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> 工作():</span></span><br><span class="line">    a = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> check_process(<span class="string">&#x27;skp_usb_moniter.exe&#x27;</span>):</span><br><span class="line">        a+= <span class="string">&#x27;税控接口服务运行中,&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        a+= <span class="string">&#x27;税控接口服务未运行,&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> check_process(<span class="string">&#x27;SunloginClient.exe&#x27;</span>):</span><br><span class="line">        a+= <span class="string">&#x27;向日葵运行中,&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        a+= <span class="string">&#x27;向日葵未运行,&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    r = requests.post(xinxiurl, data=&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;税控盘信息&#x27;</span>, <span class="string">&#x27;xinxi&#x27;</span>:  a&#125;)</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送get请求</span></span><br><span class="line">    r = requests.get(zhilingurl,params=&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;税控盘指令&#x27;</span>&#125;)</span><br><span class="line">    指令 = r.text</span><br><span class="line">    <span class="keyword">if</span> 指令 == <span class="string">&#x27;&quot;重启程序&quot;&#x27;</span>:</span><br><span class="line">        os.system(<span class="string">&#x27;D:\Desktop\s.bat&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(指令)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    工作()</span><br><span class="line">    time.sleep(<span class="number">60</span>)</span><br></pre></td></tr></table></figure><h3 id="前端获取数据-amp-发送指令"><a href="#前端获取数据-amp-发送指令" class="headerlink" title="前端获取数据&amp;发送指令"></a>前端获取数据&amp;发送指令</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取盘柜信息</span></span><br><span class="line">vm.$u.api.getPanguiInfo = <span class="function">() =&gt;</span> vm.$u.get(<span class="string">&#x27;/utils/xinxiview/&#x27;</span>);</span><br><span class="line"><span class="comment">//发送指令</span></span><br><span class="line">vm.$u.api.sendOrder = <span class="function">(<span class="params">params</span>) =&gt;</span> vm.$u.post(<span class="string">&#x27;/utils/zhilingview/&#x27;</span>, params);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">reloadShuikongpan</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">await</span> <span class="built_in">this</span>.$u.api.sendOrder(&#123;</span><br><span class="line">税控盘指令: <span class="string">&#x27;重启程序&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">this</span>.$u.toast(res)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">await</span> <span class="built_in">this</span>.$u.api.getPanguiInfo()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;在django加个小模块来监控别的电脑情况以及执行指令&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="python" scheme="https://zhongkangjk.github.io/tags/python/"/>
    
    <category term="django" scheme="https://zhongkangjk.github.io/tags/django/"/>
    
    <category term="前端" scheme="https://zhongkangjk.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>共享文件到局域网ip</title>
    <link href="https://zhongkangjk.github.io/2022/03/09/%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%88%B0%E5%B1%80%E5%9F%9F%E7%BD%91ip/"/>
    <id>https://zhongkangjk.github.io/2022/03/09/%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%88%B0%E5%B1%80%E5%9F%9F%E7%BD%91ip/</id>
    <published>2022-03-09T03:37:19.000Z</published>
    <updated>2022-03-09T03:38:15.348Z</updated>
    
    <content type="html"><![CDATA[<p>局域网共享文件到ip</p><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http.server</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">PORT = <span class="number">80</span></span><br><span class="line"></span><br><span class="line">myname = socket.getfqdn(socket.gethostname())</span><br><span class="line">myaddr = socket.gethostbyname(myname)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;请在局域网访问&#x27;</span>+myaddr)</span><br><span class="line">Handler = http.server.SimpleHTTPRequestHandler</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> socketserver.TCPServer((<span class="string">&quot;&quot;</span>, PORT), Handler) <span class="keyword">as</span> httpd:</span><br><span class="line">    <span class="comment">#print(&quot;serving at port&quot;, PORT)</span></span><br><span class="line">    httpd.serve_forever()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;局域网共享文件到ip&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="python" scheme="https://zhongkangjk.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>uniappH5转windows的步骤</title>
    <link href="https://zhongkangjk.github.io/2022/03/08/uniappH5%E8%BD%ACwindows%E7%9A%84%E6%AD%A5%E9%AA%A4/"/>
    <id>https://zhongkangjk.github.io/2022/03/08/uniappH5%E8%BD%ACwindows%E7%9A%84%E6%AD%A5%E9%AA%A4/</id>
    <published>2022-03-08T06:58:30.000Z</published>
    <updated>2022-03-23T06:30:16.588Z</updated>
    
    <content type="html"><![CDATA[<p>如标题</p><span id="more"></span><h4 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h4><h4 id="安装electron（主程序）"><a href="#安装electron（主程序）" class="headerlink" title="安装electron（主程序）"></a>安装electron（主程序）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install electron -g</span><br></pre></td></tr></table></figure><h4 id="安装electron-packager（打包用）"><a href="#安装electron-packager（打包用）" class="headerlink" title="安装electron-packager（打包用）"></a>安装electron-packager（打包用）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install electron-packager -g</span><br></pre></td></tr></table></figure><h4 id="uniapp的manifest-json修改"><a href="#uniapp的manifest-json修改" class="headerlink" title="uniapp的manifest.json修改"></a>uniapp的manifest.json修改</h4><p>根目录下的manifest.json-h5配置</p><p>运行的基础路径修改为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./</span><br></pre></td></tr></table></figure><p>不然打包出来会出现白屏，读取不到，因为打包出来的h5默认加载地址为/static/</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">去掉启用https协议</span><br></pre></td></tr></table></figure><p>不然会出现网络无法加载，去掉https不影响你请求后端的https协议。</p><h4 id="h5打包"><a href="#h5打包" class="headerlink" title="h5打包"></a>h5打包</h4><p>HbuilderX顶部菜单栏-发布-h5手机版发行-发行</p><p>发现的默认目录为：unpackage\dist\build\h5</p><h4 id="新建文件"><a href="#新建文件" class="headerlink" title="新建文件"></a>新建文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">复制代码你的项目目录/</span><br><span class="line">├── static</span><br><span class="line">└── index.html</span><br></pre></td></tr></table></figure><h4 id="新建package-json和main-js"><a href="#新建package-json和main-js" class="headerlink" title="新建package.json和main.js"></a>新建package.json和main.js</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">复制代码新建后项目目录/</span><br><span class="line">├── static</span><br><span class="line">├── package.json</span><br><span class="line">├── main.js</span><br><span class="line">└── index.html</span><br></pre></td></tr></table></figure><h4 id="在-package-json-中添加如下内容"><a href="#在-package-json-中添加如下内容" class="headerlink" title="在 package.json 中添加如下内容"></a>在 package.json 中添加如下内容</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">复制代码</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;    : &quot;app-name&quot;,</span><br><span class="line">  &quot;version&quot; : &quot;0.1.0&quot;,</span><br><span class="line">  &quot;main&quot;    : &quot;main.js&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="在-main-js-中添加下面的内容，这个-main-js-文件就是上面-package-json-中的-“main”键-的值，所以可根据需要修改"><a href="#在-main-js-中添加下面的内容，这个-main-js-文件就是上面-package-json-中的-“main”键-的值，所以可根据需要修改" class="headerlink" title="在 main.js 中添加下面的内容，这个 main.js 文件就是上面 package.json 中的 “main”键 的值，所以可根据需要修改"></a>在 main.js 中添加下面的内容，这个 main.js 文件就是上面 package.json 中的 “main”键 的值，所以可根据需要修改</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;app, BrowserWindow,Menu&#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Keep a global reference of the window object, if you don&#x27;t, the window will</span></span><br><span class="line"><span class="comment">// be closed automatically when the JavaScript object is garbage collected.</span></span><br><span class="line"><span class="keyword">let</span> win</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWindow</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">Menu.setApplicationMenu(<span class="literal">null</span>) <span class="comment">//取消菜单栏</span></span><br><span class="line">  <span class="comment">// Create the browser window.</span></span><br><span class="line">  win = <span class="keyword">new</span> BrowserWindow(&#123;<span class="attr">width</span>: <span class="number">375</span>, <span class="attr">height</span>: <span class="number">667</span>&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// and load the index.html of the app.</span></span><br><span class="line">  win.loadURL(url.format(&#123;</span><br><span class="line">    <span class="attr">pathname</span>: path.join(__dirname, <span class="string">&#x27;index.html&#x27;</span>),</span><br><span class="line">    <span class="attr">protocol</span>: <span class="string">&#x27;file:&#x27;</span>,</span><br><span class="line">    <span class="attr">slashes</span>: <span class="literal">true</span></span><br><span class="line">  &#125;))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Open the DevTools.</span></span><br><span class="line">  <span class="comment">// win.webContents.openDevTools()</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Emitted when the window is closed.</span></span><br><span class="line">  win.on(<span class="string">&#x27;closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Dereference the window object, usually you would store windows</span></span><br><span class="line">    <span class="comment">// in an array if your app supports multi windows, this is the time</span></span><br><span class="line">    <span class="comment">// when you should delete the corresponding element.</span></span><br><span class="line">    win = <span class="literal">null</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This method will be called when Electron has finished</span></span><br><span class="line"><span class="comment">// initialization and is ready to create browser windows.</span></span><br><span class="line"><span class="comment">// Some APIs can only be used after this event occurs.</span></span><br><span class="line">app.on(<span class="string">&#x27;ready&#x27;</span>, createWindow)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Quit when all windows are closed.</span></span><br><span class="line">app.on(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// On macOS it is common for applications and their menu bar</span></span><br><span class="line">  <span class="comment">// to stay active until the user quits explicitly with Cmd + Q</span></span><br><span class="line">  <span class="keyword">if</span> (process.platform !== <span class="string">&#x27;darwin&#x27;</span>) &#123;</span><br><span class="line">    app.quit()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">&#x27;activate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// On macOS it&#x27;s common to re-create a window in the app when the</span></span><br><span class="line">  <span class="comment">// dock icon is clicked and there are no other windows open.</span></span><br><span class="line">  <span class="keyword">if</span> (win === <span class="literal">null</span>) &#123;</span><br><span class="line">    createWindow()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// In this file you can include the rest of your app&#x27;s specific main process</span></span><br><span class="line"><span class="comment">// code. You can also put them in separate files and require them here.</span></span><br></pre></td></tr></table></figure><p>具体参考electron官网文档<br>如果你的网页首页的文件名不是 “index.html”，那么请在 main.js 中将其中的 ‘index.html’ 修改为你的网页首页名</p><h5 id="更新内容后再次使用HbuilderX生成h5前记得备份-package-json-main-js"><a href="#更新内容后再次使用HbuilderX生成h5前记得备份-package-json-main-js" class="headerlink" title="更新内容后再次使用HbuilderX生成h5前记得备份 package.json main.js"></a>更新内容后再次使用HbuilderX生成h5前记得备份 package.json main.js</h5><h4 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">复制代码electron-packager . 可执行文件的文件名 --win --out 打包成的文件夹名 --arch=x64位还是32位 --electron-version版本号(不是你的h5版本号，是electron版本号) --overwrite --ignore=node_modules</span><br></pre></td></tr></table></figure><h4 id="示例（可直接复制下面代码）："><a href="#示例（可直接复制下面代码）：" class="headerlink" title="示例（可直接复制下面代码）："></a>示例（可直接复制下面代码）：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">electron-packager . lan --win --out lan --arch=x64 --electron-version 17.1.0 --overwrite --ignore=node_modules --icon=2.ico</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;如标题&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="前端" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="前端" scheme="https://zhongkangjk.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="uniapp" scheme="https://zhongkangjk.github.io/tags/uniapp/"/>
    
  </entry>
  
  <entry>
    <title>神武接下来的打造宝宝计划</title>
    <link href="https://zhongkangjk.github.io/2021/10/05/%E7%A5%9E%E6%AD%A6%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9A%84%E6%89%93%E9%80%A0%E5%AE%9D%E5%AE%9D%E8%AE%A1%E5%88%92/"/>
    <id>https://zhongkangjk.github.io/2021/10/05/%E7%A5%9E%E6%AD%A6%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9A%84%E6%89%93%E9%80%A0%E5%AE%9D%E5%AE%9D%E8%AE%A1%E5%88%92/</id>
    <published>2021-10-05T13:40:35.000Z</published>
    <updated>2022-03-09T11:44:59.104Z</updated>
    
    <content type="html"><![CDATA[<p>在秋水的指导下懂了需要打造宝宝，计划</p><span id="more"></span><h3 id="卡速"><a href="#卡速" class="headerlink" title="卡速"></a>卡速</h3><p>两个卡速宝宝，一个带隐身一个不带隐身<br>完全可以用罗成青瓷鸡这种垃圾的来做</p><p>参考如图</p><p><img src="https://q1.masteryi.top/PicGo/%E5%8D%A1%E9%80%9F1.png" class="lazyload" data-srcset="https://q1.masteryi.top/PicGo/%E5%8D%A1%E9%80%9F1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="卡速1"></p><p><img src="https://q1.masteryi.top/PicGo/%E5%8D%A1%E9%80%9F2.png" class="lazyload" data-srcset="https://q1.masteryi.top/PicGo/%E5%8D%A1%E9%80%9F2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="卡速2"></p><p><img src="https://q1.masteryi.top/PicGo/%E5%8D%A1%E9%80%9F3.png" class="lazyload" data-srcset="https://q1.masteryi.top/PicGo/%E5%8D%A1%E9%80%9F3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="卡速3"></p><p><img src="https://q1.masteryi.top/PicGo/%E5%8D%A1%E9%80%9F4.png" class="lazyload" data-srcset="https://q1.masteryi.top/PicGo/%E5%8D%A1%E9%80%9F4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="卡速4"></p><h3 id="血攻"><a href="#血攻" class="headerlink" title="血攻"></a>血攻</h3><p>可以就用我那个死骑，元宵吃31个攻，19个体</p><p><img src="https://q1.masteryi.top/PicGo/%E8%A1%80%E6%94%BB.png" class="lazyload" data-srcset="https://q1.masteryi.top/PicGo/%E8%A1%80%E6%94%BB.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="血攻"></p><p>气势换吸血 感知审判少哪个都行 看护符</p><p>速度到420，气血加到3500，打符攻击争取到1520</p><h3 id="感知群法"><a href="#感知群法" class="headerlink" title="感知群法"></a>感知群法</h3><p>雪舞洗出来了</p><p><img src="https://q1.masteryi.top/PicGo/%E6%84%9F%E7%9F%A5%E7%BE%A4%E6%B3%95.png" class="lazyload" data-srcset="https://q1.masteryi.top/PicGo/%E6%84%9F%E7%9F%A5%E7%BE%A4%E6%B3%95.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="感知群法"></p><p>敏捷不要，冰霜换感知</p><p>血3000  灵700到750  元宵吃体剩下法<br>符石开红色 灵力  30+</p><h3 id="龟速宠"><a href="#龟速宠" class="headerlink" title="龟速宠"></a>龟速宠</h3><p>小号可以洗洗</p><p><img src="https://q1.masteryi.top/PicGo/%E9%BE%9F%E9%80%9F%E5%AE%A0.png" class="lazyload" data-srcset="https://q1.masteryi.top/PicGo/%E9%BE%9F%E9%80%9F%E5%AE%A0.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="龟速宠"></p><p>要鬼魂，鬼魂不吃冲击，不死的话能保证尾速拉人</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在秋水的指导下懂了需要打造宝宝，计划&lt;/p&gt;</summary>
    
    
    
    <category term="游戏" scheme="https://zhongkangjk.github.io/categories/%E6%B8%B8%E6%88%8F/"/>
    
    <category term="神武" scheme="https://zhongkangjk.github.io/categories/%E6%B8%B8%E6%88%8F/%E7%A5%9E%E6%AD%A6/"/>
    
    
    <category term="神武" scheme="https://zhongkangjk.github.io/tags/%E7%A5%9E%E6%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>本博客上线更新的方法</title>
    <link href="https://zhongkangjk.github.io/2021/10/02/%E6%9C%AC%E5%8D%9A%E5%AE%A2%E4%B8%8A%E7%BA%BF%E6%9B%B4%E6%96%B0%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>https://zhongkangjk.github.io/2021/10/02/%E6%9C%AC%E5%8D%9A%E5%AE%A2%E4%B8%8A%E7%BA%BF%E6%9B%B4%E6%96%B0%E7%9A%84%E6%96%B9%E6%B3%95/</id>
    <published>2021-10-02T11:43:10.000Z</published>
    <updated>2021-10-02T11:56:31.571Z</updated>
    
    <content type="html"><![CDATA[<p>gitpage还是稍微拉胯了点，还是部署到~上吧</p><span id="more"></span><h3 id="拉代码"><a href="#拉代码" class="headerlink" title="拉代码"></a>拉代码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> 我的博客代码 网站文件夹</span><br></pre></td></tr></table></figure><h3 id="写脚本"><a href="#写脚本" class="headerlink" title="写脚本"></a>写脚本</h3><p>在网站文件夹里建立一个脚本,记得给执行权限方便计划任务调用<br>gengxin.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#！/bin/bash</span></span><br><span class="line"><span class="built_in">cd</span> /www/wwwroot/网站文件夹</span><br><span class="line">git fetch --all</span><br><span class="line">git reset --hard origin/master</span><br><span class="line">git pull</span><br></pre></td></tr></table></figure><h3 id="设置定时任务"><a href="#设置定时任务" class="headerlink" title="设置定时任务"></a>设置定时任务</h3><p>如题，定时执行一下拉取脚本就可以了</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;gitpage还是稍微拉胯了点，还是部署到~上吧&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="linux" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/linux/"/>
    
    
    <category term="linux" scheme="https://zhongkangjk.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>兼听则明，偏信则暗</title>
    <link href="https://zhongkangjk.github.io/2021/09/20/%E5%85%BC%E5%90%AC%E5%88%99%E6%98%8E%EF%BC%8C%E5%81%8F%E4%BF%A1%E5%88%99%E6%9A%97/"/>
    <id>https://zhongkangjk.github.io/2021/09/20/%E5%85%BC%E5%90%AC%E5%88%99%E6%98%8E%EF%BC%8C%E5%81%8F%E4%BF%A1%E5%88%99%E6%9A%97/</id>
    <published>2021-09-20T07:31:16.000Z</published>
    <updated>2021-10-04T10:55:32.926Z</updated>
    
    <content type="html"><![CDATA[<p>为自己对抗信息茧房写点东西</p><span id="more"></span><p>很久没有过成长的感觉了</p><p>以前对自己成长的看法就像自然选择，通过遇到各种各样的事情，迈过它，然后变得更好，更像自己。</p><p>不知道什么时候开始接触到的东西越来越少，甚至不如以前</p><p>那个拿着BBK深夜在网上搜罗各行各业的书籍对自己未来进行畅想的自己</p><p>现在遇到的都是相同的事情，就算偶尔有些波澜，那就把它转换为跟从前类似的状况，然后用老办法对待他</p><p>懒</p><p>。</p><p>找了个锅</p><p>一定是无处不在的大数据推荐系统带来的信息茧房束缚了我</p><p>“<br>在贴心的大数据式喂养下，用户依旧拥有选择的权利，却慢慢被剥夺了选择的能力与动力。</p><p>信息茧房进入了最终极状态 - 即便一个人的兴趣爱好是吃屎，大数据也能帮他找到一万个同好，并告诉他，你不孤单，请保持。</p><p>信息茧房使人们变得自满，易怒，常常走极端。</p><p>人们比曾经任何时代都更接近信息，却离探索真相越来越远。</p><p>”@维京女侠</p><p>知乎看到的。</p><p>想起了自己使用知乎的一件趣事，</p><p>当时刚刚下载了知乎（也不知道是第几次，感觉以前有下载过，但很久了）</p><p>浏览到大概是个人生低谷相关的话题，刚好它遇到挫折的某件事是我战胜过的，于是发表了一些看法。</p><p>然后就一发不可收拾，每个几个小时，就是推送邀请回答，一模一样的问题，不同的人，还好我会屏蔽通知，但每次进入知乎就是一大串红色提醒，点进去都是那些，俨然一副我是相关问题大牛的样子。</p><p>我开始找屏蔽这个的操作，没找着，或者说没生效。</p><p>联系知乎客服，</p><p>时间有点久，记不清了，想打开知乎找找聊天记录，一番操作以后没找着，反正是没有结果的结果。</p><p>我在想如果所有的知乎使用者都是这种状态，那发展真的是，</p><p>我也不知道。</p><p>回想一下正题，</p><p>我得告诉自己对抗这个，虽然现在没什么方向，但随波逐流我肯定不乐意。</p><p>我不管，我最大。</p><p>主动检索信息，主动检索信息！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;为自己对抗信息茧房写点东西&lt;/p&gt;</summary>
    
    
    
    <category term="随笔" scheme="https://zhongkangjk.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="随笔" scheme="https://zhongkangjk.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>pandas相关操作</title>
    <link href="https://zhongkangjk.github.io/2021/09/05/pandas%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C/"/>
    <id>https://zhongkangjk.github.io/2021/09/05/pandas%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C/</id>
    <published>2021-09-05T12:53:22.000Z</published>
    <updated>2021-09-05T13:12:28.721Z</updated>
    
    <content type="html"><![CDATA[<p>pandas的操作都记在这里吧</p><span id="more"></span><h3 id="pandas提取excel"><a href="#pandas提取excel" class="headerlink" title="pandas提取excel"></a>pandas提取excel</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> 提取类():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,文件名,第几个表</span>):</span></span><br><span class="line">        self.文件 = pd.read_excel(文件名, 第几个表)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> 拿取数据(<span class="params">self,从第几行开始,*列名</span>):</span></span><br><span class="line">        self.数据 = self.文件.loc[从第几行开始-<span class="number">2</span>:,[*列名,]]</span><br><span class="line">        <span class="comment">#print(self.数据)</span></span><br><span class="line">        <span class="keyword">return</span> self.数据</span><br><span class="line"></span><br><span class="line"><span class="comment">#     </span></span><br></pre></td></tr></table></figure><h3 id="处理日期和数字空值"><a href="#处理日期和数字空值" class="headerlink" title="处理日期和数字空值"></a>处理日期和数字空值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">数据文件名 = <span class="string">&quot;名称.xlsx&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> 销售表提取():</span></span><br><span class="line">    销售表 = 提取类(数据文件名,<span class="number">0</span>)</span><br><span class="line">    销售数据 = 销售表.拿取数据(<span class="number">8234</span>,<span class="string">&#x27;企业名称&#x27;</span>,<span class="string">&#x27;日期&#x27;</span>,<span class="string">&#x27;服务费发票&#x27;</span>,<span class="string">&#x27;金额&#x27;</span>,<span class="string">&#x27;支付方式&#x27;</span>)</span><br><span class="line">    销售数据[<span class="string">&#x27;发票类型&#x27;</span>] = <span class="string">&#x27;纸票&#x27;</span></span><br><span class="line">    <span class="comment">#空着的日期按照前一个来</span></span><br><span class="line">    销售数据[<span class="string">&#x27;日期&#x27;</span>].fillna(method=<span class="string">&quot;ffill&quot;</span>,inplace=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment">#格式化日期，标记空日期</span></span><br><span class="line">    销售数据[<span class="string">&#x27;日期&#x27;</span>] = 销售数据[<span class="string">&#x27;日期&#x27;</span>].apply(<span class="keyword">lambda</span> x:x.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>) <span class="keyword">if</span> x == x <span class="keyword">and</span> <span class="built_in">type</span>(x) != <span class="built_in">type</span>(<span class="string">&#x27;sd&#x27;</span>) <span class="keyword">else</span> <span class="string">&#x27;日期为空&#x27;</span>)</span><br><span class="line">    销售数据[<span class="string">&#x27;金额&#x27;</span>] = 销售数据[<span class="string">&#x27;金额&#x27;</span>].apply(<span class="keyword">lambda</span> x:<span class="built_in">str</span>(<span class="built_in">int</span>(x)) <span class="keyword">if</span> x == x <span class="keyword">else</span> x)</span><br></pre></td></tr></table></figure><h3 id="转为列表"><a href="#转为列表" class="headerlink" title="转为列表"></a>转为列表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">销售数据 = 销售数据.values.tolist()</span><br></pre></td></tr></table></figure><h3 id="合并相同数据"><a href="#合并相同数据" class="headerlink" title="合并相同数据"></a>合并相同数据</h3><p>将A栏重复值所对应的B栏数据合并</p><p>销售数据</p><table><thead><tr><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>数据A</td><td>1</td><td>5</td></tr><tr><td>数据A</td><td>2</td><td>5</td></tr><tr><td>数据B</td><td>1</td><td>5</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将A栏重复值所对应的B栏数据合并</span></span><br><span class="line">销售数据[<span class="string">&#x27;B&#x27;</span>] = 销售数据.groupby(<span class="string">&#x27;A&#x27;</span>)[<span class="string">&#x27;B&#x27;</span>].transform(<span class="string">&#x27;,&#x27;</span>.join)</span><br></pre></td></tr></table></figure><p>销售数据-新<br>| A     | B    | C    |<br>| —– | —- | —- |<br>| 数据A | 1,2  | 5    |<br>| 数据A | 1,2  | 5    |<br>| 数据B | 1    | 5    |</p><p>之后可以去重</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;pandas的操作都记在这里吧&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="python" scheme="https://zhongkangjk.github.io/tags/python/"/>
    
    <category term="pandas" scheme="https://zhongkangjk.github.io/tags/pandas/"/>
    
  </entry>
  
  <entry>
    <title>写在django-admin里的异步爬虫按钮和日期计算</title>
    <link href="https://zhongkangjk.github.io/2021/08/23/%E5%86%99%E5%9C%A8django-admin%E9%87%8C%E7%9A%84%E5%BC%82%E6%AD%A5%E7%88%AC%E8%99%AB%E6%8C%89%E9%92%AE/"/>
    <id>https://zhongkangjk.github.io/2021/08/23/%E5%86%99%E5%9C%A8django-admin%E9%87%8C%E7%9A%84%E5%BC%82%E6%AD%A5%E7%88%AC%E8%99%AB%E6%8C%89%E9%92%AE/</id>
    <published>2021-08-23T10:58:10.000Z</published>
    <updated>2022-04-26T14:50:03.666Z</updated>
    
    <content type="html"><![CDATA[<p>用httpx的异步方法来更新requests的，快了一些</p><span id="more"></span><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> import_export <span class="keyword">import</span> resources</span><br><span class="line"><span class="keyword">from</span> import_export.admin <span class="keyword">import</span> ImportExportModelAdmin, ImportExportActionModelAdmin</span><br><span class="line"><span class="keyword">from</span> dateutil.relativedelta <span class="keyword">import</span> relativedelta</span><br><span class="line"><span class="keyword">import</span> json,requests</span><br><span class="line"><span class="keyword">from</span> cuifei.models <span class="keyword">import</span> 催费表类,可收表<span class="number">19</span>年,可收表<span class="number">20</span>年,催费表<span class="number">22</span>年类</span><br><span class="line"><span class="keyword">from</span> shuju.models <span class="keyword">import</span> 数据通知表类</span><br><span class="line"><span class="keyword">from</span> utils.models <span class="keyword">import</span> Dictionary</span><br><span class="line"><span class="keyword">import</span> httpx,json,time,math</span><br><span class="line"><span class="keyword">import</span> asyncio,datetime,calendar</span><br><span class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> TextInput, Textarea</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="comment">#引入 Workbook</span></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line">admin.site.site_header = <span class="string">&#x27;催费&#x27;</span></span><br><span class="line">admin.site.site_title = <span class="string">&#x27;催费&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> 取结果(<span class="params">r</span>):</span></span><br><span class="line">    <span class="keyword">if</span> r[<span class="string">&#x27;obj&#x27;</span>]:</span><br><span class="line">        j = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> r[<span class="string">&#x27;obj&#x27;</span>]:</span><br><span class="line">            j.append(i[<span class="string">&#x27;fwqx&#x27;</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(j),r[<span class="string">&#x27;obj&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;jbrdh&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>,<span class="literal">None</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;**************&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url_by_税号 = <span class="string">&#x27;************&#x27;</span></span><br><span class="line">查税号URL= <span class="string">&#x27;******************&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@admin.register(<span class="params">催费表<span class="number">22</span>年类</span>)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> 催费表22管理(<span class="params">ImportExportActionModelAdmin</span>):</span></span><br><span class="line">    list_display = (<span class="string">&#x27;公司名称***************&#x27;</span>)</span><br><span class="line">    search_fields = (<span class="string">&#x27;公司名称********************&#x27;</span>)</span><br><span class="line">    list_per_page = <span class="number">20</span></span><br><span class="line">    date_hierarchy = <span class="string">&#x27;到期日&#x27;</span>   <span class="comment">#时间导航栏</span></span><br><span class="line">    list_filter = (<span class="string">&#x27;区域&#x27;</span>,<span class="string">&#x27;性质&#x27;</span>,<span class="string">&#x27;到期日&#x27;</span>,UpdatedAtFilter,) <span class="comment">#筛选器</span></span><br><span class="line">    list_display_links = (<span class="string">&#x27;公司名称&#x27;</span>,)  <span class="comment">#点击修改</span></span><br><span class="line">    formfield_overrides = &#123;</span><br><span class="line">        models.CharField: &#123;<span class="string">&#x27;widget&#x27;</span>: TextInput(attrs=&#123;<span class="string">&#x27;size&#x27;</span>:<span class="string">&#x27;20&#x27;</span>&#125;)&#125;,</span><br><span class="line">        models.TextField: &#123;<span class="string">&#x27;widget&#x27;</span>: Textarea(attrs=&#123;<span class="string">&#x27;rows&#x27;</span>:<span class="number">1</span>, <span class="string">&#x27;cols&#x27;</span>:<span class="number">50</span>&#125;)&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    actions = [<span class="string">&#x27;更新可收年份&#x27;</span>,<span class="string">&#x27;更新到期日和时间&#x27;</span>,<span class="string">&#x27;export_admin_action&#x27;</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_actions</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        actions = <span class="built_in">super</span>(催费表<span class="number">22</span>管理,self).get_actions(request)</span><br><span class="line">        <span class="built_in">print</span>(actions)</span><br><span class="line">        <span class="keyword">if</span> request.user.username != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">            <span class="keyword">del</span> actions[<span class="string">&#x27;更新到期日和时间&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> actions</span><br><span class="line">    <span class="function"><span class="keyword">def</span> 更新到期日和时间(<span class="params">modeladmin, request, queryset</span>):</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> 爬(<span class="params">client,body</span>):</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> 保存结果(<span class="params">结果,body</span>):</span></span><br><span class="line">                body.到期日 = 结果[<span class="number">0</span>]</span><br><span class="line">                <span class="comment"># body.经办人电话 = 结果[1]</span></span><br><span class="line">                body.save(update_fields=[<span class="string">&#x27;到期日&#x27;</span>])</span><br><span class="line"></span><br><span class="line">            r = <span class="keyword">await</span> client.post(url_by_税号,headers=headers, data=json.dumps(&#123;<span class="string">&#x27;khsbh&#x27;</span>: body.税号,&#125;),timeout=<span class="literal">None</span>)</span><br><span class="line">            结果 = 取结果(r.json())</span><br><span class="line">            <span class="keyword">if</span> 结果[<span class="number">0</span>]:</span><br><span class="line">                保存结果(结果,body)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                用名称查的data = json.dumps(&#123;<span class="string">&#x27;count&#x27;</span>:<span class="number">100</span>,<span class="string">&#x27;keyword&#x27;</span>: body.公司名称,<span class="string">&#x27;page&#x27;</span>:<span class="number">0</span>&#125;)</span><br><span class="line">                r = <span class="keyword">await</span> client.post(查税号URL,headers=headers, data=用名称查的data,timeout=<span class="literal">None</span>)</span><br><span class="line">                res_dict = r.json()</span><br><span class="line">                <span class="keyword">if</span> res_dict[<span class="string">&#x27;obj&#x27;</span>]:</span><br><span class="line">                    税号<span class="number">1</span> = res_dict[<span class="string">&#x27;obj&#x27;</span>][-<span class="number">1</span>][<span class="string">&#x27;khsbh&#x27;</span>]</span><br><span class="line">                    r1 = <span class="keyword">await</span> client.post(url_by_税号,headers=headers, data=json.dumps(&#123;<span class="string">&#x27;khsbh&#x27;</span>: 税号<span class="number">1</span>,&#125;),timeout=<span class="literal">None</span>)</span><br><span class="line">                    结果<span class="number">1</span> = 取结果(r1.json())</span><br><span class="line">                    保存结果(结果<span class="number">1</span>,body)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">None</span>,<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> 跑():</span></span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">with</span> httpx.AsyncClient() <span class="keyword">as</span> client:</span><br><span class="line">                task_list = []</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> queryset:</span><br><span class="line">                    req = 爬(client,i)</span><br><span class="line">                    task = asyncio.create_task(req)</span><br><span class="line">                    task_list.append(task)</span><br><span class="line">                <span class="keyword">await</span> asyncio.gather(*task_list)</span><br><span class="line">        start = time.time()</span><br><span class="line">        asyncio.run(跑())</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(end-start)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;查日期完成于&#x27;</span>+time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> 更新可收年份(<span class="params">modeladmin, request, queryset</span>):</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> queryset:</span><br><span class="line">            <span class="keyword">if</span> i.到期日:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">type</span>(i.到期日) == <span class="built_in">type</span>(<span class="string">&#x27;s&#x27;</span>):</span><br><span class="line">                    到期日 = datetime.datetime.strptime(i.到期日,<span class="string">&#x27;%Y-%m-%d&#x27;</span>).date()</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    到期日 = i.到期日</span><br><span class="line">                <span class="comment"># print(i.公司名称,i.税号)</span></span><br><span class="line">                a = 可收表<span class="number">19</span>年.objects.<span class="built_in">filter</span>(公司名称__exact = i.公司名称).count()</span><br><span class="line">                <span class="keyword">if</span> a &gt; <span class="number">0</span>:</span><br><span class="line">                    i.可收<span class="number">19</span> = <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    i.可收<span class="number">19</span> = <span class="number">0</span></span><br><span class="line">                b = 可收表<span class="number">20</span>年.objects.<span class="built_in">filter</span>(Q(公司名称__exact = i.公司名称)|Q(税号__exact = i.税号)).count()</span><br><span class="line">                <span class="keyword">if</span> b &gt; <span class="number">0</span>:</span><br><span class="line">                    i.可收<span class="number">20</span> = <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    i.可收<span class="number">20</span> = <span class="number">0</span></span><br><span class="line">                c = 催费表类.objects.<span class="built_in">filter</span>(Q(公司名称__exact = i.公司名称)|Q(税号__exact = i.税号)).count()</span><br><span class="line">                <span class="keyword">if</span> c &gt; <span class="number">0</span>:</span><br><span class="line">                    i.可收<span class="number">21</span> = <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    i.可收<span class="number">21</span> = <span class="number">0</span></span><br><span class="line">                <span class="comment"># print(i.到期日)</span></span><br><span class="line">                <span class="comment"># print(datetime.date.today())</span></span><br><span class="line">                年 = datetime.datetime.now().year</span><br><span class="line">                月 = datetime.datetime.now().month</span><br><span class="line">                下一个月 = (datetime.datetime.now()+relativedelta(months=<span class="number">1</span>)).month</span><br><span class="line">                <span class="comment"># 日 = datetime.datetime.now().day</span></span><br><span class="line">                <span class="comment"># 新日 = calendar.monthrange(年,月)[1]</span></span><br><span class="line">                新日 = calendar.monthrange(年,下一个月)[<span class="number">1</span>]</span><br><span class="line">                <span class="comment"># print(新日)</span></span><br><span class="line">                <span class="comment"># print(datetime.date(年,月,新日)==i.到期日)</span></span><br><span class="line">                <span class="keyword">if</span> datetime.date(年,下一个月,新日)==到期日:</span><br><span class="line">                    差年= <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    差年 = math.ceil((datetime.date(年,下一个月,新日)-到期日)/datetime.timedelta(days=<span class="number">365</span>))</span><br><span class="line">                <span class="comment"># print(差年)</span></span><br><span class="line">                到期日年份 = i.到期日.year</span><br><span class="line">                可收字典 = &#123;<span class="number">2015</span>:<span class="number">1</span>,<span class="number">2016</span>:<span class="number">1</span>,<span class="number">2017</span>:<span class="number">1</span>,<span class="number">2018</span>:<span class="number">1</span>,<span class="number">2019</span>:i.可收<span class="number">19</span>,<span class="number">2020</span>:i.可收<span class="number">20</span>,<span class="number">2021</span>:i.可收<span class="number">21</span>,<span class="number">2022</span>:<span class="number">1</span>&#125;</span><br><span class="line">                <span class="comment"># 年份 = sum(listn[:差年])</span></span><br><span class="line">                j = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i1 <span class="keyword">in</span> <span class="built_in">range</span>(到期日年份,到期日年份+差年):</span><br><span class="line">                    <span class="comment"># print(i1)</span></span><br><span class="line">                    j += 可收字典[i1]</span><br><span class="line">                <span class="comment"># print(j)</span></span><br><span class="line">                i.几年 = j</span><br><span class="line">                i.save(update_fields=[<span class="string">&#x27;可收19&#x27;</span>,<span class="string">&#x27;可收20&#x27;</span>,<span class="string">&#x27;可收21&#x27;</span>,<span class="string">&#x27;几年&#x27;</span>])</span><br></pre></td></tr></table></figure><h3 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h3><p><code>asyncio.run()</code>和<code>asyncio.create_task()</code>这之类的函数要python3.7以后才能用</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;用httpx的异步方法来更新requests的，快了一些&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="python" scheme="https://zhongkangjk.github.io/tags/python/"/>
    
    <category term="django" scheme="https://zhongkangjk.github.io/tags/django/"/>
    
    <category term="httpx" scheme="https://zhongkangjk.github.io/tags/httpx/"/>
    
    <category term="datetime" scheme="https://zhongkangjk.github.io/tags/datetime/"/>
    
  </entry>
  
  <entry>
    <title>在windows添加webDAV网络位置</title>
    <link href="https://zhongkangjk.github.io/2021/08/18/%E5%9C%A8windows%E6%B7%BB%E5%8A%A0webDAV%E7%BD%91%E7%BB%9C%E4%BD%8D%E7%BD%AE/"/>
    <id>https://zhongkangjk.github.io/2021/08/18/%E5%9C%A8windows%E6%B7%BB%E5%8A%A0webDAV%E7%BD%91%E7%BB%9C%E4%BD%8D%E7%BD%AE/</id>
    <published>2021-08-18T11:43:54.000Z</published>
    <updated>2021-08-18T11:48:53.060Z</updated>
    
    <content type="html"><![CDATA[<p>为了方便同步数据，特给Cloudreve所提供的webDAV加到我的windows上</p><span id="more"></span><h3 id="修改注册表"><a href="#修改注册表" class="headerlink" title="修改注册表"></a>修改注册表</h3><p>修改注册表<code>计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\WebClient\Parameters</code>的<code>BasicAuthLevel</code>值为2，此意为同时支持同时支持http和https，默认只支持https</p><h3 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h3><p>服务名称为webclient</p><h3 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h3><p>在Windows资源管理器空白处右键，选添加一个网络位置，<br>填写地址，用户名和密码即可</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;为了方便同步数据，特给Cloudreve所提供的webDAV加到我的windows上&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    
    <category term="webDAV" scheme="https://zhongkangjk.github.io/tags/webDAV/"/>
    
  </entry>
  
  <entry>
    <title>更改django-admin的TextField显示长宽度</title>
    <link href="https://zhongkangjk.github.io/2021/08/17/%E6%9B%B4%E6%94%B9django-admin%E7%9A%84TextField%E6%98%BE%E7%A4%BA%E9%95%BF%E5%AE%BD%E5%BA%A6/"/>
    <id>https://zhongkangjk.github.io/2021/08/17/%E6%9B%B4%E6%94%B9django-admin%E7%9A%84TextField%E6%98%BE%E7%A4%BA%E9%95%BF%E5%AE%BD%E5%BA%A6/</id>
    <published>2021-08-17T10:34:06.000Z</published>
    <updated>2021-08-17T10:43:13.625Z</updated>
    
    <content type="html"><![CDATA[<p>今天想把django-admin的TextField字段改成快速更改，但发现太大了，格格不入</p><span id="more"></span><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在admin.py中</span></span><br><span class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> TextInput, Textarea</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YourModelAdmin</span>(<span class="params">admin.ModelAdmin</span>):</span></span><br><span class="line"></span><br><span class="line">    formfield_overrides = &#123;</span><br><span class="line">        models.CharField: &#123;<span class="string">&#x27;widget&#x27;</span>: TextInput(attrs=&#123;<span class="string">&#x27;size&#x27;</span>:<span class="string">&#x27;20&#x27;</span>&#125;)&#125;,</span><br><span class="line">        models.TextField: &#123;<span class="string">&#x27;widget&#x27;</span>: Textarea(attrs=&#123;<span class="string">&#x27;rows&#x27;</span>:<span class="number">1</span>, <span class="string">&#x27;cols&#x27;</span>:<span class="number">50</span>&#125;)&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">admin.site.register(YourModel, YourModelAdmin)</span><br></pre></td></tr></table></figure><h3 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h3><p>给Textarea改成一行 长度50就差不多了得根据预览情况，多了也没试</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;今天想把django-admin的TextField字段改成快速更改，但发现太大了，格格不入&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="python" scheme="https://zhongkangjk.github.io/tags/python/"/>
    
    <category term="django" scheme="https://zhongkangjk.github.io/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>批量把当前文件夹内的word文档转换为pdf</title>
    <link href="https://zhongkangjk.github.io/2021/08/13/%E6%89%B9%E9%87%8F%E6%8A%8A%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%E5%A4%B9%E5%86%85%E7%9A%84word%E6%96%87%E6%A1%A3%E8%BD%AC%E6%8D%A2%E4%B8%BApdf/"/>
    <id>https://zhongkangjk.github.io/2021/08/13/%E6%89%B9%E9%87%8F%E6%8A%8A%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%E5%A4%B9%E5%86%85%E7%9A%84word%E6%96%87%E6%A1%A3%E8%BD%AC%E6%8D%A2%E4%B8%BApdf/</id>
    <published>2021-08-13T13:51:00.000Z</published>
    <updated>2022-03-23T06:28:28.265Z</updated>
    
    <content type="html"><![CDATA[<p>批量把当前文件夹内的word文档转换为pdf</p><span id="more"></span><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> win32com.client <span class="keyword">import</span> Dispatch</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> walk,getcwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doc2pdf</span>(<span class="params">input_file</span>):</span></span><br><span class="line">    word = Dispatch(<span class="string">&#x27;Word.Application&#x27;</span>)</span><br><span class="line">    doc = word.Documents.Open(input_file)</span><br><span class="line">    doc.SaveAs(input_file.replace(<span class="string">&quot;.doc&quot;</span>, <span class="string">&quot;.pdf&quot;</span>), FileFormat=<span class="number">17</span>)</span><br><span class="line">    doc.Close()</span><br><span class="line">    word.Quit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    doc_files = []</span><br><span class="line">    directory = getcwd()</span><br><span class="line">    <span class="keyword">for</span> root, dirs, filenames <span class="keyword">in</span> walk(directory):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> filenames:</span><br><span class="line">            <span class="keyword">if</span> file.endswith(<span class="string">&quot;.doc&quot;</span>) <span class="keyword">or</span> file.endswith(<span class="string">&quot;.docx&quot;</span>):</span><br><span class="line">                <span class="built_in">print</span>(file)</span><br><span class="line">                doc2pdf(<span class="built_in">str</span>(root + <span class="string">&quot;\\&quot;</span> + file))</span><br></pre></td></tr></table></figure><h3 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h3><p>其中SaveAs中第二个参数FileFormat=17是指定保存文档时使用的格式，17是PDF</p><p>以下是参考</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">WdSaveFormat 枚举   </span><br><span class="line">指定要在保存文档时使用的格式。 </span><br><span class="line">版本信息 已添加版本：  </span><br><span class="line">      名称                  值           说明   </span><br><span class="line">wdFormatDocument            0   Microsoft Word 格式。   </span><br><span class="line">wdFormatDOSText             4   Microsoft DOS 文本格式。   </span><br><span class="line">wdFormatDOSTextLineBreaks   5   Microsoft DOS 文本格式，并且保留换行符。   </span><br><span class="line">wdFormatEncodedText         7   编码文本格式。   </span><br><span class="line">wdFormatFilteredHTML       10   筛选的 HTML 格式。   </span><br><span class="line">wdFormatHTML                8   标准 HTML 格式。   </span><br><span class="line">wdFormatRTF                 6   RTF 格式。   </span><br><span class="line">wdFormatTemplate            1   Word 模板格式。   </span><br><span class="line">wdFormatText                2   Microsoft Windows 文本格式。   </span><br><span class="line">wdFormatTextLineBreaks      3   Windows 文本格式，并且保留换行符。   </span><br><span class="line">wdFormatUnicodeText         7   Unicode 文本格式。   </span><br><span class="line">wdFormatWebArchive          9   Web 档案格式。   </span><br><span class="line">wdFormatXML                11   可扩展标记语言 (XML) 格式。   </span><br><span class="line">wdFormatDocument97          0   Microsoft Word 97 文档格式。   </span><br><span class="line">wdFormatDocumentDefault    16   Word 默认文档文件格式。对于 Word 2010，这是 DOCX 格式。   </span><br><span class="line">wdFormatPDF                17   PDF 格式。   </span><br><span class="line">wdFormatTemplate97          1   Word 97 模板格式。   </span><br><span class="line">wdFormatXMLDocument        12   XML 文档格式。   </span><br><span class="line">wdFormatXMLDocumentMacroEnabled   13   启用了宏的 XML 文档格式。   </span><br><span class="line">wdFormatXMLTemplate        14   XML 模板格式。   </span><br><span class="line">wdFormatXMLTemplateMacroEnabled   15   启用了宏的 XML 模板格式。   </span><br><span class="line">wdFormatXPS            18   XPS 格式。</span><br></pre></td></tr></table></figure><p>文档网址</p><p><a href="https://docs.microsoft.com/zh-cn/office/vba/api/word.wdsaveformat">https://docs.microsoft.com/zh-cn/office/vba/api/word.wdsaveformat</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;批量把当前文件夹内的word文档转换为pdf&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="python" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/python/"/>
    
    
    <category term="python" scheme="https://zhongkangjk.github.io/tags/python/"/>
    
    <category term="word" scheme="https://zhongkangjk.github.io/tags/word/"/>
    
    <category term="pdf" scheme="https://zhongkangjk.github.io/tags/pdf/"/>
    
  </entry>
  
  <entry>
    <title>centos8安装python3.7</title>
    <link href="https://zhongkangjk.github.io/2021/08/10/centos8%E5%AE%89%E8%A3%85python3-7/"/>
    <id>https://zhongkangjk.github.io/2021/08/10/centos8%E5%AE%89%E8%A3%85python3-7/</id>
    <published>2021-08-10T13:42:18.000Z</published>
    <updated>2022-03-23T06:33:12.243Z</updated>
    
    <content type="html"><![CDATA[<p>因为得在破腾讯的轻量上安装python3.7，不太好弄找了个攻略</p><span id="more"></span><p>1、执行以下命令，更新yum源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update</span><br></pre></td></tr></table></figure><p>2、安装依赖包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel libffi-devel gcc make</span><br></pre></td></tr></table></figure><p>3、下载安装包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.python.org/ftp/python/3.7.6/Python-3.7.6.tar.xz</span><br></pre></td></tr></table></figure><p>4、解压</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xf  Python-3.7.6.tar.xz</span><br></pre></td></tr></table></figure><p>5、编译安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建安装目录</span></span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/python-3.7.6</span><br><span class="line"><span class="comment">#进入安装目录</span></span><br><span class="line"><span class="built_in">cd</span> Python-3.7.6</span><br><span class="line"><span class="comment">#配置编译的路径</span></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/python3.7.6 --with-ssl</span><br><span class="line"><span class="comment">#按提示继续命令</span></span><br><span class="line">./configure --enable-optimizations</span><br><span class="line"><span class="comment">#开始编译</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>6、验证是否成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -V</span><br><span class="line">pip3 -V</span><br></pre></td></tr></table></figure><h3 id="原文链接："><a href="#原文链接：" class="headerlink" title="原文链接："></a>原文链接：</h3><p><a href="https://blog.csdn.net/ispeasant/article/details/107791316">https://blog.csdn.net/ispeasant/article/details/107791316</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;因为得在破腾讯的轻量上安装python3.7，不太好弄找了个攻略&lt;/p&gt;</summary>
    
    
    
    <category term="计算机" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"/>
    
    <category term="linux" scheme="https://zhongkangjk.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/linux/"/>
    
    
    <category term="python" scheme="https://zhongkangjk.github.io/tags/python/"/>
    
    <category term="linux" scheme="https://zhongkangjk.github.io/tags/linux/"/>
    
  </entry>
  
</feed>
